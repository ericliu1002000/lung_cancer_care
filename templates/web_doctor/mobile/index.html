{% extends "layouts/base_portal.html" %}

{% block body %}
<div class="min-h-screen bg-slate-100 pb-safe-bottom font-sans">
    <!-- Header Section -->
    <div class="bg-[#4DB6AC] pt-safe-top pb-16 px-5 rounded-b-[2rem] shadow-md relative">
        <div class="flex items-center gap-4 pt-6 relative z-10">
            <!-- Avatar -->
            
            <svg t="1769436602879" class="icon w-16 h-16" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5325" width="64" height="64"><path d="M512 512m-509.72444441 0a509.72444441 509.72444441 0 1 0 1019.44888889 0 509.72444441 509.72444441 0 1 0-1019.44888889 0Z" fill="#619CF1" p-id="5326"></path><path d="M512 1021.72444441c147.14311111 0 279.72266669-62.35022226 372.76444444-162.06848004-0.2468977-2.37112887-1.10591999-4.5112889-2.64874666-6.3863467-14.0504178-17.08032001-74.80661332-61.34442659-134.91655122-90.65699546-76.25727999-37.19281781-147.03729777-44.94222226-147.03729774-44.94222216l-105.78830216 303.74798212c5.8515911 0.19683562 11.72593779 0.30606222 17.62645334 0.30606224z" fill="#FFFFFF" p-id="5327"></path><path d="M512 1021.72444441c2.78869333 0 5.57169778-0.03071995 8.35015109-0.07509331l-103.2192-310.95466667s-70.78115554 7.75054223-147.03843553 44.94222222c-60.10993773 29.31256885-120.86613332 73.57667557-134.91655124 90.65699555-1.47342221 1.79086224-2.31537781 3.82634669-2.60437317 6.07118226C225.8909866 956.32384 361.30474667 1021.72444441 512 1021.72444441z" fill="#FFFFFF" p-id="5328"></path><path d="M429.35978669 661.95228444l154.89820438 0 0 107.06261333L429.35978669 769.01489776z" fill="#F6CAA9" p-id="5329"></path><path d="M710.48988445 441.32693333c0 126.06464002-90.51363551 228.26097773-202.16832011 228.26097774-111.65923555 0-202.1728711-102.19633778-202.17287102-228.26097774s90.51363551-228.26097773 202.17287102-228.2609778c111.65468458 0 202.16831996 102.19633778 202.16832011 228.2609778" fill="#F6CAA9" p-id="5330"></path><path d="M430.80704001 691.35701339s-17.36817791-3.89119998-13.2334933 22.1206755c4.55224887 28.61511109 90.14727121 269.56344889 90.14727107 269.56344875l90.56028449-258.09009757s8.26823114-34.41208894-12.71694228-31.64615131l-77.8433422 66.87744003-76.91377778-68.8253154z" fill="#88ddd1" p-id="5331"></path><path d="M539.04383995 893.93720882s-17.1611022-77.42577767-17.7811911-80.4989155c-0.6189511-3.07313778 5.58421322-11.67815089 5.58421348-16.59221331s-4.34517327-7.98719997-9.92483567-14.13347555c-5.58421322-6.14627553-9.9248355-18.22947555-9.92483559-18.2294756l0 0.58595565c-0.51655113 1.39946665-4.6034489 12.20835555-9.82243552 17.94958231-5.58421322 6.14627553-9.9248355 9.21941333-9.92483558 14.13347532 0 4.91861334 6.2043023 13.51907559 5.58421334 16.59221341-0.6189511 3.07313778-16.12913783 78.04017776-16.12913772 78.04017768l31.63363554 91.87100449-0.61895113-0.61326209 31.32416003-89.10506681z" fill="#3bae9e" p-id="5332"></path><path d="M331.70431993 454.70719996c0 18.8472889-13.90478222 34.12878227-31.06133326 34.12878226-17.15200001 0-31.05678222-15.28149332-31.05678222-34.12878216s13.90478222-34.12878227 31.05678222-34.12878228c17.15655119 0 31.06133328 15.28149332 31.06133326 34.12878218M746.63253326 454.28736004c0 18.8472889-13.90478222 34.12878227-31.06133325 34.12878217-17.15200001 0-31.05678222-15.28149332-31.05678222-34.12878217s13.90478222-34.12878227 31.05678222-34.1287823c17.15655119 0 31.06133328 15.28149332 31.06133325 34.1287823" fill="#F6CAA9" p-id="5333"></path><path d="M621.26421327 287.47320891s56.4724622 25.737671 18.07132455 44.75676439c-35.01283555 10.06933334-107.29927111 3.35644444-141.18115563-1.12071115-33.88188437-4.47260445-128.19228451-35.80245344-128.19228442-35.80245326l2.82510224 22.93873772s71.37621334 25.68647122 131.01169776 34.12423115c59.29756444 8.3911111 125.37173338 16.7879111 153.6079644-4.47260439 24.84792889-15.66720001 18.07132446-42.52103116 18.0713245-42.52103114s31.05678222-3.35644444 34.44508448-10.06933334l-10.1649067-19.02364441c0.00113783 0-11.85678221 6.71288887-78.49415118 11.19004443" fill="#ECB485" p-id="5334"></path><path d="M634.44081778 197.39875555s93.36718221-41.77237344-22.59057777-61.16807101c-115.95320889-19.39569777-236.42567107 41.77237344-265.04191997 104.43207114 0 0-51.19772437-8.94975994-61.74264888 98.46783988 0 65.64522674 10.54492449 82.05653331 10.5449245 82.05653331s16.18488889-4.47715556 15.05848875 38.04387561c0 0 12.42225777 14.54193777 18.0667734-1.12071119 0 0 3.38830215-29.09411554-1.12640002-38.04387556 0 0 49.69585779-26.85383114 45.17660445-121.96408877 0 0 53.08415996 25.737671 134.40455108 34.68743107 81.31583998 8.94975994 128.75434653 1.12071104 128.75434655 1.1207111s0 51.46965334 45.17660463 83.92135114l-2.25735117 36.9231644s1.12640003 7.83360011 9.03395552 7.83359999 9.03850667-12.31075562 9.03850669-12.31075556-1.13095118-26.85269332 16.94037337-30.21027554c0 0 21.45962667-80.56376889-5.6502045-143.22460452 0 0 37.27473778-14.54648895 21.45962674-49.23391998-15.80714668-34.68629332-95.24565334-30.21027554-95.24565337-30.21027551" fill="#4A4A4A" p-id="5335"></path><path d="M429.77279999 652.13098667s29.35808 15.1563377 71.95420446 15.15633778c50.03377767 2.05027554 82.70051556-14.74673781 82.70051559-14.7467378l0 15.15633766s-54.99903999 29.4980267-79.80942231 29.49802682-75.25717337-34.82168889-75.25717326-34.82168886l0.41187555-10.2422756z" fill="#ECB485" p-id="5336"></path><path d="M722.07928893 906.41408l-36.62961778-1e-8c-4.78890665 0-8.68693332-3.84455115-8.68693341-8.56974217 0-4.71950219 3.89802667-8.56519111 8.68693341-8.56519116l19.26030218 0 0-31.53351115c0-4.72405331 3.89802667-8.56974226 8.68693337-8.56974212s8.68238204 3.84455115 8.68238221 8.56974212l2e-8 48.66844449zM641.64408887 906.4129422l-36.63416887-1e-8 0-48.66389326c0-4.72860447 3.89802667-8.57429333 8.68693333-8.57429337s8.68238204 3.84455115 8.6823823 8.57429337l0 31.5289599 19.26485324 0c4.78890665 0 8.68238204 3.84455115 8.68238228 8.56974224 0 4.72064001-3.89233778 8.56519111-8.68238228 8.56519113z" fill="#88ddd1" p-id="5337"></path><path d="M714.72924444 295.47406219l-2.58503112-8.61752885-3.91395559-10.01358217s-20.32867556 6.15310226-86.96604429 10.63025773c0 0 56.4724622 25.737671 18.07132438 44.7567644-1.15939555 0.33336891-2.36657778 0.64625778-3.6056178 0.94321779 0.89315559 6.52515554 2.2983111 15.40551117 4.17905775 23.12760891 6.77432897-2.04572448 12.69418662-4.78663105 17.49788449-8.40362665 24.84792889-15.66720001 18.07132446-42.52103116 18.07132441-42.52103112s35.86275564-3.18805338 39.25105777-9.90208004z" fill="#272727" p-id="5338"></path><path d="M352.35498666 893.50826669c31.03175104 0 56.27676447-24.90709323 56.27676453-55.51559113 0-25.92540446-18.10773333-47.74912-42.50055119-53.82712889 0.07395555-0.54954668 0.12515556-1.10705773 0.12515554-1.67594666l0-61.79157327a529.44440885 529.44440885 0 0 0-25.67964449 7.22943995c-0.04437333 1.76128001-0.06826653 3.50549339-0.06826668 5.21216008l0 49.34997324c0 0.41187566 0.02389341 0.81919985 0.0625779 1.22197329-25.39292437 5.35893335-44.4928 27.65596443-44.49280005 54.28224007 0 30.60736004 25.24387557 55.51445333 56.27676444 55.51445326z m-1e-8-84.24561783c16.05745778 0 29.12369793 12.88874669 29.12369778 28.7300267 0 15.84014222-13.06510207 28.72888889-29.12369778 28.72888889-16.05745778 0-29.12369793-12.88874669-29.12369784-28.72888889 0-15.84128004 13.06510207-28.73002667 29.12369784-28.7300267zM725.89198222 852.73144887l0-12.52920882c0-29.51281777-21.43573333-54.16732437-49.74592001-59.64117343l0-45.83765329a527.91751121 527.91751121 0 0 0-27.12120889-7.55939556l0 53.9488711c-27.04497771 6.41706684-47.20640005 30.4651378-47.2064 59.08935118l0 12.52920882c0 6.79708441 5.60128002 12.32668437 12.49621345 12.32668445 6.89038222 0 12.49621334-5.53073764 12.4962132-12.32668445l0-12.52920883c0-19.9202134 16.4260978-36.12899561 36.61937783-36.12899549l0.84992 0c20.18872891 0 36.61937778 16.20878223 36.61937774 36.1289955l0 12.52920882c0 6.79708441 5.60583126 12.32668437 12.4962134 12.32668445 6.8892443 0.00113782 12.49621334-5.52959997 12.49621328-12.32668445z" fill="#3bae9e" p-id="5339"></path></svg>
            <!-- Doctor Info -->
            <div class="text-white">
                <div class="flex items-end gap-2">
                    <h1 class="text-xl font-bold">{{ doctor.name }}</h1>
                    <span class="text-sm font-bold ">{{doctor.title }}</span>
                </div>
                <div class="flex items-center gap-1 mt-1">
                <p class="text-sm font-medium ">{{ doctor.department }}</p>
                <p class="text-sm font-medium ">/</p>
                <p class="text-sm font-medium">{{ doctor.hospital }}</p>
                </div>
                <p class="text-sm mt-0.5 ">工作室：{{ doctor.studio_name }}</p>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="px-4 -mt-10 relative z-20 space-y-4">
        {% if doctor_error %}
        <div class="bg-white rounded-xl shadow-sm border border-red-100 p-4 text-sm text-red-600">
            {{ doctor_error }}
        </div>
        {% endif %}
        
        <!-- Stats Card -->
        <div class="bg-white rounded-xl shadow-sm p-4 flex items-center divide-x divide-slate-100">
            <div class="flex-1 text-center">
                <p class="text-xs text-slate-500 font-bold mb-1">管理患者</p>
                <p class="text-lg font-bold text-slate-800">{{ stats.managed_patients }} <span class="text-xs font-normal text-slate-400">人</span></p>
            </div>
            <div class="flex-1 text-center">
                <p class="text-xs text-slate-500 font-bold mb-1">今日活跃</p>
                <p class="text-lg font-bold text-slate-800">{{ stats.today_active }} <span class="text-xs font-normal text-slate-400">人</span></p>
            </div>
        </div>

        <!-- Alerts Section -->
        <div class="rounded-xl overflow-hidden shadow-sm">
            <div class="bg-[#E57373] px-4 py-2 flex items-center gap-2 text-white">
                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                </svg>
                <span class="font-bold text-sm">患者异常警报 ({{ stats.alerts_count }})</span>
            </div>
            <div class="bg-white p-2 space-y-2">
                {% for alert in alerts %}
                <div class="bg-white border-b border-slate-50 last:border-0 p-3 flex items-center justify-between active:bg-slate-50 transition">
                    <div class="flex items-center gap-2">
                        <span class="text-red-500">
                            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                        </span>
                        <span class="text-sm font-bold text-slate-700 truncate w-[170px]">{{ alert.patient_name }} - {{ alert.type }}</span>
                    </div>
                    <div class="flex items-center ">
                        <span class="text-xs text-slate-400">{{ alert.time }}</span>
                        <svg class="w-4 h-4 text-slate-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                    </div>
                </div>
                {% empty %}
                <div class="p-4 text-center text-slate-400 text-sm">暂无异常警报</div>
                {% endfor %}
            </div>
        </div>

        <!-- Consultations Section -->
        <div class="rounded-xl overflow-hidden shadow-sm">
            <div class="bg-[#FBC02D] px-4 py-2 flex items-center gap-2 text-white">
                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
                </svg>
                <span class="font-bold text-sm">患者咨询 ({{ stats.consultations_count }})</span>
            </div>
            <div class="bg-white p-2 space-y-2">
                {% for item in consultations %}
                <div class="bg-white border-b border-slate-50 last:border-0 p-3 flex items-center justify-between active:bg-slate-50 transition">
                    <div class="flex items-center gap-2 overflow-hidden">
                        <span class="text-yellow-500 shrink-0">
                            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </span>
                        <div class="truncate text-sm text-slate-700">
                            <span class="font-bold">{{ item.patient_name }}</span> - "{{ item.content }}"
                        </div>
                    </div>
                    <div class="flex items-center gap-2 shrink-0">
                        <span class="text-xs text-slate-400">{{ item.time }}</span>
                        <svg class="w-4 h-4 text-slate-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                    </div>
                </div>
                {% empty %}
                <div class="p-4 text-center text-slate-400 text-sm">暂无咨询消息</div>
                {% endfor %}
            </div>
        </div>

        <!-- Bottom Actions -->
        <div class="grid grid-cols-2 gap-4 pt-2">
            <!-- Patient Management -->
            <a href="{% url 'web_doctor:mobile_patient_list' %}" class="bg-white p-6 rounded-xl shadow-sm flex flex-col items-center justify-center gap-3 active:scale-95 transition h-32">
                <div class="w-12 h-12 rounded-full bg-[#4DB6AC]/10 flex items-center justify-center text-[#4DB6AC]">
                    <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                    </svg>
                </div>
                <span class="font-bold text-slate-700">患者管理</span>
            </a>
            
            <!-- My Assistant -->
            <a href="#" class="bg-white p-6 rounded-xl shadow-sm flex flex-col items-center justify-center gap-3 active:scale-95 transition h-32">
                <div class="w-12 h-12 rounded-full bg-[#4DB6AC]/10 flex items-center justify-center text-[#4DB6AC]">
                    <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm0 4c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm6 12H6v-1.4c0-2 4-3.1 6-3.1s6 1.1 6 3.1V19z"/>
                    </svg>
                </div>
                <span class="font-bold text-slate-700">我的助理</span>
            </a>
        </div>
    </div>
</div>
{% endblock %}
