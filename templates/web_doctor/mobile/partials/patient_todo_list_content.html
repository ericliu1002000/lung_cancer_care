{% for item in todo_page %}
  <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-4">
    <div class="flex items-start gap-3">
      <div class="min-w-0 flex-1">
        <div class="text-sm font-bold text-slate-800 truncate">
          {% if item.patient_name %}{{ item.patient_name }} - {% endif %}{{ item.event_title }}
        </div>
        <div class="mt-1 text-xs text-slate-500 flex flex-wrap items-center gap-x-3 gap-y-1">
          <span>事件类型：<span class="text-slate-700">{{ item.event_type }}</span></span>
          <span>事件等级：<span class="text-slate-700">{{ item.event_level }}</span></span>
        </div>
      </div>
      <div class="shrink-0">
        {% if item.status == 'pending' %}
          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-amber-100 text-amber-800">待跟进</span>
        {% elif item.status == 'escalate' %}
          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-rose-100 text-rose-800">升级主任</span>
        {% elif item.status == 'completed' %}
          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">已完成</span>
        {% else %}
          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-slate-100 text-slate-800">{{ item.status_display }}</span>
        {% endif %}
      </div>
    </div>

    <div class="mt-3 grid grid-cols-1 gap-2 text-xs">
      <div class="flex items-center justify-between gap-3">
        <span class="text-slate-500 shrink-0">事件时间</span>
        <span class="text-slate-700 min-w-0 truncate">{{ item.event_time|default:"-" }}</span>
      </div>
      <div class="flex items-center justify-between gap-3">
        <span class="text-slate-500 shrink-0">处理时间</span>
        <span class="text-slate-700 min-w-0 truncate">{{ item.handle_time|default:"-" }}</span>
      </div>
      <div class="flex items-center justify-between gap-3">
        <span class="text-slate-500 shrink-0">处理人</span>
        <span class="text-slate-700 min-w-0 truncate">{{ item.handler|default:"-" }}</span>
      </div>
    </div>

    <div class="mt-4 flex items-center justify-end">
      <button
        type="button"
        data-todo-detail-trigger
        data-event-title="{{ item.event_title|default:'' }}"
        data-patient-name="{{ item.patient_name|default:'' }}"
        data-event-content="{{ item.event_content|default:'' }}"
        data-handle-content="{{ item.handle_content|default:'' }}"
        data-event-time="{{ item.event_time|default:'' }}"
        data-handle-time="{{ item.handle_time|default:'' }}"
        data-handler="{{ item.handler|default:'' }}"
        data-status-display="{{ item.status_display|default:'' }}"
        class="text-blue-600 font-medium text-xs px-3 py-1.5 border border-blue-200 rounded-lg active:scale-[0.99] transition bg-blue-50/40"
      >
        查看详情
      </button>
    </div>
  </div>
{% empty %}
  <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-8 text-center text-slate-400 text-sm">
    暂无待办事项
  </div>
{% endfor %}

{% if todo_page.paginator.num_pages > 1 %}
  <div class="bg-white rounded-2xl shadow-sm border border-slate-100 px-4 py-3 flex items-center justify-between text-sm">
    {% if todo_page.has_previous %}
      <a
        class="px-3 py-1.5 rounded-md border border-slate-200 text-slate-600 active:bg-slate-50 transition"
        href="?page={{ todo_page.previous_page_number }}&pagesize={{ pagesize }}{% if patient %}&patient_id={{ patient.id }}{% endif %}"
        hx-get="?page={{ todo_page.previous_page_number }}&pagesize={{ pagesize }}{% if patient %}&patient_id={{ patient.id }}{% endif %}"
        hx-target="#mobile-todo-list-content"
        hx-swap="innerHTML"
        hx-indicator="#mobile-todo-loading"
      >上一页</a>
    {% else %}
      <span class="px-3 py-1.5 rounded-md border border-slate-100 text-slate-300">上一页</span>
    {% endif %}
    <div class="text-slate-500 text-xs">
      第 <span class="font-bold text-slate-700">{{ todo_page.number }}</span>/<span>{{ todo_page.paginator.num_pages }}</span> 页
    </div>
    {% if todo_page.has_next %}
      <a
        class="px-3 py-1.5 rounded-md border border-slate-200 text-slate-600 active:bg-slate-50 transition"
        href="?page={{ todo_page.next_page_number }}&pagesize={{ pagesize }}{% if patient %}&patient_id={{ patient.id }}{% endif %}"
        hx-get="?page={{ todo_page.next_page_number }}&pagesize={{ pagesize }}{% if patient %}&patient_id={{ patient.id }}{% endif %}"
        hx-target="#mobile-todo-list-content"
        hx-swap="innerHTML"
        hx-indicator="#mobile-todo-loading"
      >下一页</a>
    {% else %}
      <span class="px-3 py-1.5 rounded-md border border-slate-100 text-slate-300">下一页</span>
    {% endif %}
  </div>
{% endif %}

