<div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
    {# 标题栏 #}
    <div class="px-6 py-4 border-b border-slate-100 flex items-center gap-4 bg-slate-50/50">
        <h3 class="text-base font-bold text-slate-800 border-l-4 border-indigo-500 pl-3">概况</h3>
        <div class="flex items-center gap-2 px-1 py-1 bg-amber-50 border border-amber-100 rounded text-xs text-amber-700">
            <svg t="1766297687926" class="icon w-8 h-8" viewBox="0 0 1204 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="13413" width="48" height="48"><path d="M1247.119 391.831l2.1 1.663q-1.035-0.875-2.1-1.663zM-33.29 394.223l3.792-3.004c-4.553 3.167-8.267 7.216-10.964 11.922z" p-id="13414"></path><path d="M100.094 1025.202c-0.335 2.246-0.686 4.478-0.991 6.738 0.632-2.397 1.004-5.153 1.025-7.992zM66.475 1057.29zM32.898 1021.133q0.365-2.523 0.758-5.046c-0.512 2.136-0.819 4.598-0.846 7.124z" p-id="13415"></path><path d="M1183.934 1013.3c0.422 2.64 0.802 5.294 1.181 7.948-0.106-3.188-0.621-6.214-1.497-9.083zM1116.45 1030.643c-0.291-2.086-0.597-4.157-0.919-6.228 0.164 2.851 0.645 5.522 1.408 8.070z" p-id="13416"></path><path d="M838.858 313.771h-46.031l-24.591 139.174h41.743q41.29 0 66.012-18.581t30.848-53.265q11.887-67.326-67.982-67.326z" fill="#fb4065" p-id="13417"></path><path d="M983.722 204.992h-750.886c-0.008 0-0.018 0-0.027 0-31.855 0-57.681 25.807-57.715 57.653v374.76c0.031 31.85 25.86 57.656 57.715 57.656 0.010 0 0.019 0 0.029 0h750.885c0.012 0 0.027 0 0.045 0 31.852 0 57.675-25.809 57.7-57.654v-374.76c-0.023-31.849-25.848-57.656-57.7-57.656-0.014 0-0.029 0-0.047 0zM329.58 622.995l-64.278-348.869h50.102l45.9 272.748c1.11 6.693 1.744 14.404 1.744 22.263 0 3.179-0.105 6.334-0.309 9.463l1.145-0.426c6.755-22.046 17.464-41.111 31.416-57.305l126.091-246.742h48.293l-190.019 348.869h-50.086zM657.27 312.195l-48.131 272.748h33.546l-6.695 38.053h-112.307l6.723-38.068h33.619l48.131-272.748h-33.546l6.723-38.068h112.307l-6.723 38.068h-33.648zM954.537 379.288q-9.072 51.355-51.253 83.21t-96.642 30.104h-45.361l-23.030 130.393h-45.185l61.638-348.869h99.283q56.635 0 83.137 27.246t17.416 77.945z" fill="#fb4065" p-id="13418"></path></svg>
            <span class="font-medium">已服务：{{ served_days }}天，剩余：{{ remaining_days }}天</span>
        </div>
    </div>

    <div class="p-6 space-y-4">
        {# 工作室信息 #}
        <div class="flex items-start">
            <span class="w-24 shrink-0 text-slate-500 text-sm">工作室：</span>
            <span class="text-slate-800 text-sm font-medium">{{ doctor_info.hospital }} <span class="text-slate-300 mx-2">|</span> {{ doctor_info.studio }}</span>
        </div>

        {# 基本信息 #}
        <div class="flex items-start">
            <span class="w-24 shrink-0 text-slate-500 text-sm">基本信息：</span>
            <span class="text-slate-800 text-sm font-medium">
                {{ patient.name }} 
                <span class="text-slate-300 mx-2">|</span> 
                {{ patient.get_gender_display }} 
                <span class="text-slate-300 mx-2">|</span> 
                {% if patient.age %}{{ patient.age }}岁{% else %}--{% endif %}
            </span>
        </div>

        {# 病情信息列表 #}
        <div class="flex items-start">
            <span class="w-24 shrink-0 text-slate-500 text-sm">肿瘤诊断：</span>
            <span class="text-slate-800 text-sm font-medium">{{ medical_info.diagnosis|default:"无" }}</span>
        </div>
        <div class="flex items-start">
            <span class="w-24 shrink-0 text-slate-500 text-sm">危险因素：</span>
            <span class="text-slate-800 text-sm">{{ medical_info.risk_factors|default:"无" }}</span>
        </div>
        <div class="flex items-start">
            <span class="w-24 shrink-0 text-slate-500 text-sm">临床诊断：</span>
            <span class="text-slate-800 text-sm">{{ medical_info.clinical_diagnosis|default:"无" }}</span>
        </div>
        <div class="flex items-start">
            <span class="w-24 shrink-0 text-slate-500 text-sm">基因检测：</span>
            <span class="text-slate-800 text-sm">{{ medical_info.gene_test|default:"无" }}</span>
        </div>
        <div class="flex items-start">
            <span class="w-24 shrink-0 text-slate-500 text-sm">既往病史：</span>
            <span class="text-slate-800 text-sm">{{ medical_info.history|default:"无" }}</span>
        </div>
        <div class="flex items-start">
            <span class="w-24 shrink-0 text-slate-500 text-sm">手术信息：</span>
            <span class="text-slate-800 text-sm">{{ medical_info.surgery|default:"无" }}</span>
        </div>

        {# 备注 #}
        <div class="flex items-start">
            <span class="w-24 shrink-0 text-slate-500 text-sm pt-0.5">备注：</span>
            <div id="patient-remark-display" class="flex items-center gap-2 group  text-sm">
                <span class="text-slate-800 text-sm" style="font-size: 14px;">{{ medical_info.remark }}</span>
                <button onclick="document.getElementById('edit-remark-modal').showModal()" class="text-indigo-600  group-hover:opacity-100 transition-opacity hover:text-indigo-700">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
                </button>
            </div>
        </div>

         <div class="flex items-start">
            <span class="w-24 shrink-0 text-slate-500 text-sm">依从性：</span>
            <div class="text-slate-800 text-sm space-y-1">
                <div class="flex items-center gap-2">
                    <div>用药依从率：{{ medication_adherence_display|default:"--" }}</div>
                    <div>常规监测综合依从率：{{ monitoring_adherence_display|default:"--" }}</div>
                </div>
                {% if adherence_date_range %}
                    <div class="text-slate-500 text-xs">统计区间：{{ adherence_date_range }}</div>
                {% endif %}
            </div>
        </div>
    </div>

{# 备注编辑弹框 #}

<dialog id="edit-remark-modal" class="rounded-xl shadow-xl backdrop:bg-slate-900/30 w-full max-w-2xl  p-0 open:animate-fade-in">
    <div class="flex flex-col max-h-[90vh]">
        <div class="px-6 py-4 border-b border-slate-100 flex items-center justify-between bg-slate-50/50">
            <h3 class="text-lg font-bold text-slate-800">编辑备注</h3>
            <button type="button" onclick="this.closest('dialog').close()" class="text-slate-400 hover:text-slate-600">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>
        
        <form method="post" 
              hx-post="{% url 'web_doctor:patient_home_remark_update' patient.id %}" 
              hx-target="#patient-remark-display" 
              hx-swap="outerHTML"
              class="p-6">
            {% csrf_token %}
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">备注内容</label>
                    <textarea placeholder="请输入备注信息（最多500字）" name="remark"   rows="4"   maxlength="500"  required class="border border-[#999999] p-2 w-full rounded-lg  text-sm focus:border-[#6366f1] focus:outline-none">{{ patient.remark }}</textarea>
                    <div class="text-right text-xs text-slate-400 mt-1">最多500字</div>
                </div>
            </div>

            <div class="flex items-center justify-end gap-3 pt-4 mt-4">
                <button type="button" onclick="this.closest('dialog').close()" class="px-4 py-2 text-sm text-slate-600 hover:bg-slate-50 rounded-lg transition-colors">取消</button>
                <button type="submit" class="px-6 py-2 text-sm text-white bg-indigo-600 hover:bg-indigo-700 rounded-lg shadow-sm transition-colors">确定保存</button>
            </div>
        </form>
    </div>
</dialog>
</div>
