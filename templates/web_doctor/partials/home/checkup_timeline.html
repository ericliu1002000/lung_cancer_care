<div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden mt-6" x-data="{ selectedMonth: '{{ current_month }}' }">
    {# 标题栏 #}
    <div class="px-6 py-4 border-b border-slate-100 flex items-center justify-between bg-slate-50/50">
        <h3 class="text-base font-bold text-slate-800 border-l-4 border-indigo-500 pl-3">复查/诊疗</h3>
        <button 
            class="text-sm text-indigo-600 hover:text-indigo-800 flex items-center gap-1"
            hx-get="{% url 'web_doctor:patient_workspace_section' patient.id 'checkup_history' %}"
            hx-target="#patient-content"
        >
            历史记录
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
        </button>
    </div>

    <div class="p-6">
        {# 顶部操作栏 #}
        <div class="flex items-center justify-between mb-8">
            <div class="flex gap-4">
                <button class="px-4 py-2 bg-white border border-slate-200 rounded text-slate-600 text-sm hover:border-indigo-500 hover:text-indigo-600 transition-colors flex items-center gap-2">
                    <span class="text-lg leading-none">+</span> 新增复查记录
                </button>
                <button class="px-4 py-2 bg-white border border-slate-200 rounded text-slate-600 text-sm hover:border-amber-500 hover:text-amber-600 transition-colors flex items-center gap-2">
                    <span class="text-lg leading-none">+</span> 新增门诊记录
                </button>
                <button class="px-4 py-2 bg-white border border-slate-200 rounded text-slate-600 text-sm hover:border-purple-500 hover:text-purple-600 transition-colors flex items-center gap-2">
                    <span class="text-lg leading-none">+</span> 新增住院记录
                </button>
            </div>
            
            {# 图例 #}
            <div class="flex items-center gap-4 text-sm">
                <div class="flex items-center gap-1">
                    <svg class="w-4 h-4 text-green-600" fill="currentColor" viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>
                    <span class="text-slate-600">复查</span>
                </div>
                <div class="flex items-center gap-1">
                    <svg class="w-4 h-4 text-amber-500" fill="currentColor" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                    <span class="text-slate-600">门诊</span>
                </div>
                <div class="flex items-center gap-1">
                    <svg class="w-4 h-4 text-purple-600" fill="currentColor" viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zm-7-2h2v-2h-2v2zm0-4h2v-2h-2v2zm0-4h2V7h-2v2z"/></svg>
                    <span class="text-slate-600">住院</span>
                </div>
            </div>
        </div>

        {# 时间轴图表 #}
        <div class="relative w-full overflow-x-auto pb-4">
            <div class="min-w-[800px] flex justify-between items-end min-h-40 relative px-4">
                {# 月份柱状条 #}
                {% for month_data in timeline_data %}
                <div 
                    class="flex flex-col items-center gap-2 cursor-pointer group relative  "
                    :class="selectedMonth === '{{ month_data.month_label }}' ? 'bg-[rgba(22,164,106,0.3)] ' : 'bg-[#f1f1f1]'"
                    @click="selectedMonth = '{{ month_data.month_label }}'"
                >
                    {# 柱子上方的图标统计 #}
                    <div class="flex flex-col items-center gap-1 mb-1 h-[80px] justify-end">
                        {% if month_data.checkup_count > 0 %}
                        <div class="flex items-center text-sm text-slate-600">
                            <svg class="w-4 h-4 text-green-600 mr-0.5" fill="currentColor" viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>
                            {{ month_data.checkup_count }}
                        </div>
                        {% endif %}
                        
                        {% if month_data.outpatient_count > 0 %}
                        <div class="flex items-center text-sm text-slate-600">
                            <svg class="w-4 h-4 text-amber-500 mr-0.5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                            {{ month_data.outpatient_count }}
                        </div>
                        {% endif %}
                        
                        {% if month_data.hospitalization_count > 0 %}
                        <div class="flex items-center text-sm text-slate-600 ">
                            <svg class="w-4 h-4 text-purple-600 mr-0.5" fill="currentColor" viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zm-7-2h2v-2h-2v2zm0-4h2v-2h-2v2zm0-4h2V7h-2v2z"/></svg>
                            {{ month_data.hospitalization_count }}
                        </div>
                        {% endif %}
                    </div>

                    {# 柱体 #}
                    <div 
                        class="w-8 transition-all duration-300 rounded-t-sm"
                    ></div>

                    {# 月份标签 #}
                    <div 
                        class="text-sm font-medium transition-colors  text-black  p-2"
                        :class="selectedMonth === '{{ month_data.month_label }}' ? ' bg-green-600' : 'bg-[#c4bcbc]'"
                    >
                        {{ month_data.month_name }}
                    </div>

                   
                </div>
                {% endfor %}
            </div>
        </div>

                {# 底部详情展示区域 #}
        <div class="mt-4 bg-slate-50/50 rounded-lg border border-slate-100 p-4 min-h-[120px] overflow-x-auto">
            <div class="flex gap-4 min-w-max relative pt-6">
                {# 时间轴横线 #}
                <div class="absolute top-2.5 left-0 w-full h-0.5 bg-slate-200"></div>

                {% for month_data in timeline_data %}
                <div x-show="selectedMonth === '{{ month_data.month_label }}'" class="flex gap-4 animate-fade-in">
                    {% for event in month_data.events %}
                    <div class="relative flex flex-col items-center group">
                        {# 时间轴上的圆点 #}
                        <div class="w-3 h-3 rounded-full border-2 bg-white z-10 mb-2 
                             {% if event.type == 'checkup' %}border-green-600 text-green-600
                             {% elif event.type == 'outpatient' %}border-amber-500 text-amber-500
                             {% else %}border-purple-600 text-purple-600{% endif %}">
                        </div>
                        
                        {# 卡片内容 #}
                        <div class="w-32 rounded overflow-hidden shadow-sm border text-center transition-transform hover:-translate-y-1 
                             {% if event.type == 'checkup' %}border-green-200 bg-green-50
                             {% elif event.type == 'outpatient' %}border-amber-200 bg-amber-50
                             {% else %}border-purple-200 bg-purple-50{% endif %}">
                            <div class="py-1 text-xs font-bold text-white 
                                 {% if event.type == 'checkup' %}bg-green-600
                                 {% elif event.type == 'outpatient' %}bg-amber-500
                                 {% else %}bg-purple-600{% endif %}">
                                {{ event.type_display }}
                            </div>
                            <div class="py-1.5 text-xs font-medium text-slate-700">
                                {{ event.date }}
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="text-slate-400 text-sm py-8 px-4">
                        本月无记录
                    </div>
                    {% endfor %}
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
