<div id="patient-workspace-tabs" class="flex items-center gap-6 px-6 border-b border-slate-200 bg-white h-14" {% if oob %}hx-swap-oob="true"{% endif %}>
    {# 患者主页 #}
    {% if active_tab == 'home' %}
        <span class="text-indigo-600 border-b-2 border-indigo-500 font-medium h-full flex items-center px-4">
            患者主页
        </span>
    {% else %}
        <a
            href="#"
            class="text-slate-500 hover:text-slate-800 h-full flex items-center transition px-4"
            hx-get="{% url 'web_doctor:patient_workspace_section' patient.id 'home' %}"
            hx-target="#patient-content"
            hx-swap="innerHTML"
        >
            患者主页
        </a>
    {% endif %}

    {# 患者指标 #}
    {% if active_tab == 'indicators' %}
        <span class="text-indigo-600 border-b-2 border-indigo-500 font-medium h-full flex items-center px-4">
            患者指标
        </span>
    {% else %}
        <a
            href="#"
            class="text-slate-500 hover:text-slate-800 h-full flex items-center transition px-4"
            hx-get="{% url 'web_doctor:patient_workspace_section' patient.id 'indicators' %}"
            hx-target="#patient-content"
            hx-swap="innerHTML"
        >
            患者指标
        </a>
    {% endif %}

    {# 管理统计 #}
    {% if active_tab == 'statistics' %}
        <span class="text-indigo-600 border-b-2 border-indigo-500 font-medium h-full flex items-center px-4">
            管理统计
        </span>
    {% else %}
        <a
            href="#"
            class="text-slate-500 hover:text-slate-800 h-full flex items-center transition px-4"
            hx-get="{% url 'web_doctor:patient_workspace_section' patient.id 'statistics' %}"
            hx-target="#patient-content"
            hx-swap="innerHTML"
        >
            管理统计
        </a>
    {% endif %}

    {# 管理设置 #}
    {% if active_tab == 'settings' %}
        <span class="text-indigo-600 border-b-2 border-indigo-500 font-medium h-full flex items-center px-4">
            管理设置
        </span>
    {% else %}
        <a
            href="#"
            class="text-slate-500 hover:text-slate-800 h-full flex items-center transition px-4"
            hx-get="{% url 'web_doctor:patient_workspace_section' patient.id 'settings' %}"
            hx-target="#patient-content"
            hx-swap="innerHTML"
        >
            管理设置
        </a>
    {% endif %}

    {# 检查报告 #}
    {% if active_tab == 'reports' %}
        <span class="text-indigo-600 border-b-2 border-indigo-500 font-medium h-full flex items-center px-4">
            检查报告
        </span>
    {% else %}
        <a
            href="#"
            class="text-slate-500 hover:text-slate-800 h-full flex items-center transition px-4"
            hx-get="{% url 'web_doctor:patient_workspace_section' patient.id 'reports' %}"
            hx-target="#patient-content"
            hx-swap="innerHTML"
        >
            检查报告
        </a>
    {% endif %}
</div>

<script>
    (function() {
        // 全局监听 HTMX swap 事件
        // 使用标志位防止重复绑定，因为此模板可能会被多次加载
        if (!window.hasPatientTabScrollHandler) {
            document.body.addEventListener('htmx:afterSwap', function(evt) {
                // 检查是否是内容区域的更新
                if (evt.detail.target.id === 'patient-content') {
                    // 使用 setTimeout 确保 DOM 渲染完成，避免竞态条件
                    setTimeout(function() {
                        // 1. 重置窗口滚动
                        window.scrollTo(0, 0);
                        // 2. 重置容器滚动 (针对 overflow-y-auto 的容器)
                        var container = document.getElementById('patient-content');
                        if (container) {
                            container.scrollTop = 0;
                        }
                    }, 50);
                }
            });
            window.hasPatientTabScrollHandler = true;
        }
    })();
</script>
