{% extends "layouts/base_portal.html" %}

{% block body %}
<div class="min-h-screen bg-slate-50 pb-safe-bottom font-sans">
    <!-- Top Bar -->
    <div class="bg-gray-200 text-center py-2 text-sm text-gray-600 sticky top-0 z-10">
        完成问卷后将会同步给您的医生
    </div>

    <!-- Survey Form -->
    <form id="survey-form" class="p-4" onsubmit="return false;">
        {% csrf_token %}
        
        <!-- Step 1: Sleep -->
        <div id="step-1" class="survey-step">
            {% include "web_patient/followup/partials/step1_sleep.html" %}
        </div>
        
        <!-- Step 2: Pain -->
        <div id="step-2" class="survey-step hidden">
            {% include "web_patient/followup/partials/step2_pain.html" %}
        </div>

        <!-- Step 3: Cough -->
        <div id="step-3" class="survey-step hidden">
             {% include "web_patient/followup/partials/step3_cough.html" %}
        </div>

        <!-- Step 4: Appetite -->
        <div id="step-4" class="survey-step hidden">
             {% include "web_patient/followup/partials/step4_appetite.html" %}
        </div>

        <!-- Step 5: Emotion -->
        <div id="step-5" class="survey-step hidden">
             {% include "web_patient/followup/partials/step5_emotion.html" %}
        </div>

        <!-- Step 6: Physical -->
        <div id="step-6" class="survey-step hidden">
             {% include "web_patient/followup/partials/step6_physical.html" %}
        </div>

        <!-- Step Finish -->
        <div id="step-finish" class="survey-step hidden">
             <div class="bg-white rounded-xl p-8 shadow-sm mt-10 text-left">
                <h2 class="text-xl font-bold text-slate-800 mb-6">您的问卷已完成，将同步给医生</h2>
                <p class="text-slate-600 mb-8 leading-relaxed">建议：继续按医嘱服药，密切关注相关指标，如有不适，请联系医生</p>
                
                <!-- Watermark placeholder -->
                <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 opacity-5 pointer-events-none">
                    <span class="text-6xl font-bold text-slate-400">W盟门</span>
                </div>
             </div>
             
             <div class="mt-8 px-4">
                <a href="{% url 'web_patient:patient_home' %}" class="block w-full py-3 bg-blue-600 text-white text-center rounded-lg font-bold shadow-md hover:bg-blue-700 transition">返回</a>
             </div>
        </div>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        window.nextStep = function(currentStepIndex) {
            // Validation (Optional: Check if at least one input is checked in the current step)
            // const currentStepDiv = document.getElementById('step-' + currentStepIndex);
            // const inputs = currentStepDiv.querySelectorAll('input[type="radio"], input[type="checkbox"]');
            // let answered = false;
            // for (let i = 0; i < inputs.length; i++) {
            //     if (inputs[i].checked) {
            //         answered = true;
            //         break;
            //     }
            // }
            // if (inputs.length > 0 && !answered) {
            //     alert("请回答本页问题后再继续");
            //     return;
            // }

            // Hide current
            document.getElementById('step-' + currentStepIndex).classList.add('hidden');
            
            // Show next
            const nextIndex = currentStepIndex + 1;
            const nextStepDiv = document.getElementById('step-' + nextIndex);
            
            if (nextStepDiv) {
                nextStepDiv.classList.remove('hidden');
                window.scrollTo(0, 0);
            } else {
                // If no next step (meaning we finished step 5), show finish
                document.getElementById('step-finish').classList.remove('hidden');
                // Here you would typically submit the data via AJAX
                // submitData();
            }
        }
    });
</script>
{% endblock %}
