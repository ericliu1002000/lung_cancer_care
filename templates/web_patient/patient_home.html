{% extends "layouts/base_portal.html" %} {% block body %}
<div class="min-h-screen bg-white pb-24 relative font-sans">
  <!-- 1. Top Header Background (Deep Gradient) -->
  <div
    class="bg-gradient-to-b from-[#0F4C81] to-[#1E6FAD] pt-safe-top pb-20 px-5 relative rounded-b-[2rem] shadow-md"
  >
    <!-- Header Content -->
    <!-- 如果用户已登录，显示用户信息和服务天数；如果未登录，显示注册/家属入口按钮 -->
    <div class="relative z-10 pt-4 flex items-center justify-between mb-2">
      <!-- Logged In State: User Info & Service Days -->
      <div class="flex items-center gap-3 w-full justify-between">
        <div class="flex items-center gap-3">
          <div class="relative">
            <div
              class="w-12 h-12 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center border-2 border-white/40 text-white overflow-hidden shadow-inner"
            >
              <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
                <path
                  d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"
                />
              </svg>
            </div>
          </div>
          <div>
            <h1
              class="text-xl font-bold text-white tracking-wide drop-shadow-md"
            >
              {{patient.name}}
            </h1>
            <div class="flex items-center mt-1.5">
              <span
                class="bg-black/20 backdrop-blur-md text-white text-[11px] px-2.5 py-0.5 rounded-full border border-white/20 flex items-center gap-1 shadow-sm"
              >
                <svg
                  class="w-3 h-3 text-yellow-300"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                  />
                </svg>
                已守护 {{ service_days }} 天
              </span>
            </div>
          </div>
        </div>

        <!-- Message Icon (Only for logged in users) -->
        {% comment %}
        <button
          class="relative w-10 h-10 rounded-full bg-white/10 flex items-center justify-center text-white active:bg-white/20 transition border border-white/10"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"
            />
          </svg>
          <span
            class="absolute top-2.5 right-2.5 w-2 h-2 bg-red-500 rounded-full border border-white"
          ></span>
        </button>
        {% endcomment %}
      </div>
    </div>
  </div>

  <!-- Main Content Area -->
  <div class="px-4 -mt-14 relative z-20 space-y-6">
    <!-- Consultation Card (Floating) -->
    <div
      class="bg-white rounded-2xl p-5 shadow-xl shadow-slate-200/60 border border-slate-200 flex items-center justify-between relative overflow-hidden group"
    >
      <div class="flex items-center gap-4 relative z-10">
        <div
          class="w-12 h-12 bg-gradient-to-br from-emerald-400 to-teal-600 rounded-xl flex items-center justify-center text-white shadow-lg shadow-emerald-200"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2.5"
              d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"
            />
          </svg>
        </div>
        <div>
          <div class="flex items-center gap-2">
            <h2 class="text-lg font-bold text-slate-900">问题咨询</h2>
            {% if is_member %}
            <span
              class="text-[10px] px-1.5 py-0.5 rounded bg-red-50 text-red-500 font-bold border border-red-100"
              >会员开通此功能</span
            >
            {% endif %}
          </div>
          <p class="text-sm text-slate-500 mt-0.5">在线与专业医生一对一沟通</p>
        </div>
      </div>
      <!-- Decoration -->
      <div
        class="absolute -right-4 -bottom-4 w-20 h-20 bg-slate-50 rounded-full opacity-50 z-0"
      ></div>
    </div>

    <!-- 2. Feature Shortcuts (3 Columns with Gradient Backgrounds) -->
    <div class="grid grid-cols-3 gap-3">
      <!-- Health Data -->
      <a
        href="{% url 'web_patient:health_records' %}?patient_id={{ patient_id }}"
        class="h-24 rounded-2xl bg-gradient-to-br from-[#FF8C61] to-[#FF6B6B] shadow-md shadow-orange-100 flex flex-col items-center justify-center gap-2 active:scale-95 transition relative overflow-hidden group"
      >
        <div
          class="absolute top-0 right-0 w-16 h-16 bg-white/10 rounded-full -mr-6 -mt-6"
        ></div>
        <div
          class="w-10 h-10 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center text-white mb-0.5"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"
            />
          </svg>
        </div>
        <span class="text-sm font-bold text-white tracking-wide">健康档案</span>
      </a>

      <!-- Medication -->
      <a
        href="{% url 'web_patient:my_medication' %}?openid={{ user.wx_openid }}"
        class="h-24 rounded-2xl bg-gradient-to-br from-[#5E9EFF] to-[#4364F7] shadow-md shadow-blue-100 flex flex-col items-center justify-center gap-2 active:scale-95 transition relative overflow-hidden group"
      >
        <div
          class="absolute top-0 right-0 w-16 h-16 bg-white/10 rounded-full -mr-6 -mt-6"
        ></div>
        <div
          class="w-10 h-10 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center text-white mb-0.5"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"
            />
          </svg>
        </div>
        <span class="text-sm font-bold text-white tracking-wide">当前用药</span>
      </a>

      <!-- Plan -->
      <a
        href="{% url 'web_patient:management_plan' %}?openid={{ user.wx_openid }}"
        class="h-24 rounded-2xl bg-gradient-to-br from-[#00C9A7] to-[#00A99D] shadow-md shadow-teal-100 flex flex-col items-center justify-center gap-2 active:scale-95 transition relative overflow-hidden group"
      >
        <div
          class="absolute top-0 right-0 w-16 h-16 bg-white/10 rounded-full -mr-6 -mt-6"
        ></div>
        <div
          class="w-10 h-10 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center text-white mb-0.5"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
            />
          </svg>
        </div>
        <span class="text-sm font-bold text-white tracking-wide">管理计划</span>
      </a>
    </div>

    <!-- 3. Service Package (Darker Gradient Background) -->
    <div>
      <div class="flex items-center gap-2 mb-3">
        <span class="w-1 h-4 bg-orange-500 rounded-full"></span>
        <h3 class="text-lg font-bold text-slate-800">服务包</h3>
      </div>
      {% if patient.is_member and patient.membership_expire_date %}
      <div
        class="relative overflow-hidden rounded-2xl bg-gradient-to-r from-[#FFF7ED] to-[#FFEDD5] border border-orange-100 p-5 shadow-sm"
      >
        <div class="flex items-center justify-between relative z-10">
          <div class="flex items-center gap-3">
            <!-- <div class="w-11 h-11 shrink-0 rounded-full bg-orange-200/50 flex items-center justify-center text-orange-700">
               <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l2.4 7.2h7.6l-6 4.8 2.4 7.2-6-4.8-6 4.8 2.4-7.2-6-4.8h7.6z"/></svg>
             </div> -->
            <div>
              <p class="text-lg font-bold text-orange-900">VIP 会员服务中</p>
              <p class="text-sm text-orange-800/80 mt-0.5 font-medium">
                有效期至 {{ patient.membership_expire_date|date:"Y年n月j日" }}
              </p>
            </div>
          </div>
          <a
            href="{{ buy_url }}"
            class="shrink-0 px-3 py-2 rounded-xl bg-white text-orange-700 text-sm font-bold shadow-sm border border-orange-100 active:bg-orange-50"
          >
            续费
          </a>
        </div>
        <div
          class="absolute -right-4 -bottom-8 text-orange-200/40 transform rotate-12 pointer-events-none"
        >
          <svg class="w-36 h-36" fill="currentColor" viewBox="0 0 24 24">
            <path
              d="M12 2l2.4 7.2h7.6l-6 4.8 2.4 7.2-6-4.8-6 4.8 2.4-7.2-6-4.8h7.6z"
            />
          </svg>
        </div>
      </div>
      {% else %}
      <a
        href="{{ buy_url }}"
        class="block relative overflow-hidden transition group"
      >
        <div
          class="relative overflow-hidden rounded-2xl bg-gradient-to-r from-[#3C415C] to-[#2C3145] shadow-lg shadow-slate-300 p-5 group"
        >
          <!-- Decorative Circle -->
          <div
            class="absolute -right-6 -top-6 w-32 h-32 bg-white/5 rounded-full blur-xl"
          ></div>

          <div class="flex justify-between items-center relative z-10">
            <div class="text-white">
              <h3 class="text-lg font-bold mb-1">肺癌院外康复管理服务包</h3>
              <p class="text-sm text-slate-300 mb-4 font-medium">
                有效期：一年
              </p>
              <button
                class="bg-gradient-to-r from-orange-400 to-pink-500 text-white text-sm font-bold px-4 py-2 rounded-full shadow-md active:opacity-90 transition flex items-center gap-1"
              >
                点击购买
                <svg
                  class="w-3.5 h-3.5"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 5l7 7-7 7"
                  />
                </svg>
              </button>
            </div>
            <!-- Icon/Illustration -->
            <div
              class="w-16 h-16 rounded-full bg-white/10 flex items-center justify-center text-orange-400 backdrop-blur-sm border border-white/5"
            >
              <svg class="w-9 h-9" fill="currentColor" viewBox="0 0 20 20">
                <path
                  fill-rule="evenodd"
                  d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z"
                  clip-rule="evenodd"
                />
              </svg>
            </div>
          </div>
        </div>
      </a>
      {% endif %}
    </div>

    <!-- 4. Daily Plan List (Light Background Items on White Page) -->
    <div>
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center gap-2">
          <span class="w-1 h-4 bg-blue-600 rounded-full"></span>
          <h3 class="text-lg font-bold text-slate-800">今日计划</h3>
        </div>
        {% if daily_plans %}
        <a
          href="{% url 'web_patient:management_plan' %}?openid={{ user.wx_openid }}"
          class="text-sm text-slate-500 font-medium flex items-center hover:text-blue-600 transition"
        >
          查看历史
          <svg
            class="w-4 h-4 ml-0.5"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 5l7 7-7 7"
            />
          </svg>
        </a>
        {% endif %}
      </div>

      {% if daily_plans %}
      <div class="space-y-3">
        {% for plan in daily_plans %}
        <div
          class="bg-slate-50 rounded-xl p-4 border border-slate-200 flex items-center justify-between active:bg-slate-100 transition"
        >
          <div class="flex items-center gap-4">
            <div
              class="w-10 h-10 rounded-full flex items-center justify-center shrink-0 bg-white shadow-sm text-slate-600"
            >
              {% if plan.type == 'medication' %}
              <svg
                t="1765679457106"
                class="icon w-5 h-5"
                viewBox="0 0 1024 1024"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
                p-id="22091"
                width="32"
                height="32"
              >
                <path
                  d="M902.4 121.6c-51.2-51.2-121.6-76.8-192-76.8s-140.8 25.6-192 76.8L121.6 512c-108.8 108.8-108.8 281.6 0 384 51.2 51.2 121.6 76.8 192 76.8s140.8-25.6 192-76.8l396.8-384c51.2-51.2 76.8-121.6 76.8-192 0-76.8-25.6-147.2-76.8-198.4zM480 870.4c-44.8 44.8-102.4 70.4-166.4 70.4s-121.6-25.6-166.4-70.4C57.6 780.8 57.6 633.6 147.2 537.6l179.2-179.2 332.8 332.8-179.2 179.2z m364.8-665.6c-6.4 6.4-19.2 6.4-25.6 0-32-32-70.4-44.8-108.8-44.8-44.8 0-83.2 19.2-108.8 44.8l-121.6 128c-12.8 0-19.2 6.4-19.2 6.4-6.4 0-12.8 0-12.8-6.4-6.4-6.4-6.4-19.2 0-25.6l128-128c38.4-38.4 83.2-57.6 140.8-57.6 51.2 0 102.4 19.2 140.8 57.6-6.4 6.4-6.4 19.2-12.8 25.6z"
                  fill="#1684FC"
                  p-id="22092"
                ></path>
              </svg>
              {% elif plan.type == 'temperature' %}
              <svg
                t="1765679517010"
                class="icon w-6 h-6"
                viewBox="0 0 1024 1024"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
                p-id="24205"
                width="32"
                height="32"
              >
                <path
                  d="M846.611917 85.510536c-59.643402-39.140439-139.895167-22.38994-178.919972 37.309744L341.052606 622.593817c-7.867178 12.038174-11.592013 31.724539-8.668427 45.816488l20.085454 96.674806L266.953981 895.961882c-12.363585 18.891256-7.082302 44.254923 11.799744 56.646138 18.885116 12.390191 44.193525 7.113001 56.561204-11.778254l84.470857-129.270179 99.121532-20.745487c14.048971-2.960425 30.577413-14.245446 38.444591-26.282596l326.637292-499.773538C923.014005 205.057259 906.247132 124.651998 846.611917 85.510536zM866.518293 253.290797 539.881001 753.064334c-4.828982 7.399527-16.636912 15.46932-25.25929 17.267269L390.907061 796.223297c-2.734274 0.569982-5.499248 0.047072-7.839549-1.474584-2.320858-1.542122-3.921309-3.879354-4.489244-6.603395l-25.749454-123.968429c-1.805112-8.654101 0.867764-22.718421 5.689582-30.116925l326.643432-499.774561c32.712029-50.059116 100.024088-64.095807 150.015665-31.28247C885.185444 135.813199 899.246695 203.243961 866.518293 253.290797zM774.693957 194.285938c-38.542828-25.302269-90.436732-14.480806-115.656113 24.118304l-14.263865 21.825075 37.60241 24.663726c7.603165 4.997827 9.743922 15.259542 4.780887 22.892383-4.999874 7.610328-15.249309 9.748015-22.858614 4.76656l-37.59013-24.681122-51.584865 78.9317 37.601386 24.662703c7.615445 5.01113 9.751085 15.258519 4.770653 22.87908-4.980431 7.621585-15.216563 9.756201-22.817682 4.774747l-37.615713-24.692379-51.577702 78.929654 37.589107 24.681122c3.704368 2.425236 6.230911 6.134721 7.123234 10.45205 0.902556 4.330632 0.069585 8.741082-2.351558 12.42703-4.981455 7.621585-15.232936 9.759271-22.838148 4.761444l-37.59627-24.679076-51.577702 78.929654 37.594223 24.664749c3.697205 2.426259 6.235005 6.149047 7.126304 10.467399 0.900509 4.316306 0.069585 8.741082-2.344395 12.426007-4.983501 7.606235-15.226796 9.741875-22.839171 4.747117L417.768849 587.568093l-10.570753 16.173354c-3.721765 5.705955-5.783727 16.544815-4.384867 23.214724l19.85214 95.576799c0.440022 2.113127 1.674129 3.919263 3.461845 5.105275 1.799996 1.167592 3.935636 1.572822 6.043646 1.1328l95.385441-19.953448c6.650467-1.38658 15.748682-7.614421 19.470447-13.319353l251.835655-385.320832C824.095088 271.575232 813.253158 219.583091 774.693957 194.285938z"
                  fill="#01B695"
                  p-id="24206"
                ></path>
                <path
                  d="M176.23277 179.806155c18.10024-1.804089 28.052916-11.755742 29.877471-29.877471-1.824555-17.188474-11.777231-26.694989-29.877471-28.519544-17.20894 1.824555-26.715455 11.33107-28.519544 28.519544C149.517315 168.050414 159.02383 178.002067 176.23277 179.806155L176.23277 179.806155zM176.23277 94.247524c34.397415 3.628644 53.410444 22.195511 57.039087 55.68116-3.628644 34.418904-22.641673 53.431933-57.039087 57.039087-33.506115-3.607154-52.072983-22.620184-55.68116-57.039087C124.159788 116.444059 142.727679 97.876168 176.23277 94.247524L176.23277 94.247524zM345.991082 110.544699c47.977711 2.715855 72.868611 15.405875 74.694189 38.026058-0.912789 14.493086-8.148587 22.195511-21.728884 23.086811-3.628644 0-9.060353-1.357927-16.297175-4.074805-12.688997-4.519943-24.912389-6.79066-36.668131-6.79066-41.654702 1.824555-63.383586 28.073382-65.186651 78.767971 2.715855 47.999201 24.444738 73.335239 65.186651 76.052117 11.755742 0 24.445762-3.162016 38.026058-9.506515 7.235798-3.607154 13.113669-5.432733 17.655102-5.432733 12.668531 0.912789 20.370956 9.061376 23.086811 24.444738-0.912789 24.445762-27.161616 37.113269-78.767971 38.026058-74.248028-4.519943-114.077152-46.174646-119.509884-124.942617C231.91393 158.543899 271.743054 115.976408 345.991082 110.544699L345.991082 110.544699z"
                  fill="#01B695"
                  p-id="24207"
                ></path>
              </svg>
              {% elif plan.type == 'bp_hr' %}
              <svg
                class="w-5 h-5 text-purple-500"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"
                />
              </svg>
              {% elif plan.type == 'spo2' %}
              <svg
                class="w-5 h-5 text-cyan-500"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"
                />
              </svg>
              {% elif plan.type == 'weight' %}
              <svg
                class="w-5 h-5 text-emerald-500"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3"
                />
              </svg>
              {% elif plan.type == 'breath' %}
              <svg
                t="1765679809370"
                class="icon w-6 h-6"
                viewBox="0 0 1024 1024"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
                p-id="30291"
                width="48"
                height="48"
              >
                <path
                  d="M540.8 185.6c-3.2-12.8-16-25.6-28.8-25.6-16 0-32 12.8-32 32V435.2c-6.4 35.2-44.8 60.8-102.4 60.8-16 0-32 12.8-32 32s12.8 32 32 32h32c41.6-6.4 80-22.4 102.4-51.2l3.2-3.2 3.2 3.2c28.8 32 76.8 48 131.2 48 16 0 32-12.8 32-32s-12.8-32-32-32c-60.8 0-102.4-28.8-102.4-67.2V192l-6.4-6.4zM611.2 288c12.8-9.6 25.6-12.8 41.6-9.6h9.6l9.6 3.2c76.8 22.4 160 105.6 192 284.8 25.6 134.4 22.4 220.8-9.6 268.8-12.8 19.2-28.8 28.8-48 32h-9.6c-16 0-35.2-6.4-44.8-12.8-35.2 3.2-70.4 3.2-105.6-3.2-51.2-12.8-86.4-38.4-92.8-80-6.4-41.6-9.6-89.6-6.4-166.4 0-19.2 16-32 32-32s28.8 16 28.8 35.2v38.4c0 51.2 0 86.4 6.4 115.2 6.4 28.8 73.6 41.6 137.6 32 6.4 0 12.8 0 19.2 3.2 9.6 6.4 22.4 9.6 28.8 9.6 3.2 0 3.2-3.2 6.4-6.4 19.2-25.6 22.4-92.8 0-217.6-16-89.6-48-153.6-89.6-195.2-25.6-25.6-48-38.4-64-41.6h-3.2l-3.2 3.2c-6.4 6.4-12.8 28.8-19.2 67.2-3.2 16-19.2 28.8-35.2 25.6-16-3.2-28.8-19.2-25.6-38.4 6.4-67.2 19.2-99.2 44.8-115.2z m-249.6-9.6c19.2-3.2 38.4 0 51.2 9.6 22.4 16 38.4 48 48 108.8 3.2 16-9.6 35.2-25.6 38.4-16 3.2-32-9.6-35.2-25.6-6.4-38.4-12.8-60.8-19.2-67.2l-3.2-3.2h-3.2c-16 3.2-38.4 16-64 41.6-41.6 41.6-73.6 105.6-89.6 195.2-22.4 124.8-19.2 192 0 217.6l6.4 6.4c6.4 0 19.2-3.2 28.8-9.6 6.4-3.2 12.8-6.4 19.2-3.2 64 9.6 134.4-3.2 137.6-32 6.4-35.2 9.6-80 6.4-153.6 0-19.2 12.8-32 28.8-32s32 12.8 32 32c3.2 80 0 128-6.4 166.4-9.6 44.8-41.6 70.4-92.8 80-35.2 6.4-70.4 6.4-102.4 3.2-16 6.4-32 12.8-51.2 12.8h-9.6c-19.2-3.2-35.2-12.8-48-32-32-44.8-35.2-134.4-9.6-268.8 35.2-185.6 124.8-265.6 201.6-284.8z"
                  fill="#0b988f"
                  p-id="30292"
                ></path>
              </svg>
              {% elif plan.type == 'sputum' %}
              <svg
                t="1765679596369"
                class="icon w-5 h-5"
                viewBox="0 0 1024 1024"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
                p-id="25405"
                width="48"
                height="48"
              >
                <path
                  d="M668.58734933 702.14178133a34.95253333 34.95253333 0 0 1-3.49525333-69.90506666l86.91529955-9.08765867-17.47626666-27.72900978a34.95253333 34.95253333 0 0 1 23.30168889-53.12785067l155.65528177-26.56392533a34.95253333 34.95253333 0 0 1 11.88386134 69.90506667l-104.15854934 17.70928356 19.34040178 30.99124622a34.95253333 34.95253333 0 0 1-25.63185778 52.66181688l-142.83935288 14.9130809zM927.46911289 930.03229867a33.78744889 33.78744889 0 0 1-21.43755378-7.45654045l-101.59536356-80.15780977-21.20453688 49.86561422a35.18555022 35.18555022 0 0 1-55.45801956 12.34989511l-118.13956266-104.62458311a34.71951645 34.71951645 0 1 1 46.60337777-52.19578312l82.02194489 72.46825245 20.03945244-46.60337778a35.88460089 35.88460089 0 0 1 23.3016889-20.27246933 34.48649955 34.48649955 0 0 1 30.29219555 6.52447289l137.71298133 108.58587022a34.48649955 34.48649955 0 0 1 5.59240534 48.93354667 34.25348267 34.25348267 0 0 1-27.72900978 12.582912z"
                  fill="#cbdaf9"
                  p-id="25406"
                  data-spm-anchor-id="a313x.search_index.0.i30.323b3a81mlEN19"
                  class=""
                ></path>
                <path
                  d="M407.1424 802.33904355a34.95253333 34.95253333 0 0 1-19.34040178-64.07964444 56.85612089 56.85612089 0 0 0 0-98.566144A34.95253333 34.95253333 0 1 1 426.48280178 581.90506667a126.52817067 126.52817067 0 0 1 0 214.84157155 34.25348267 34.25348267 0 0 1-19.34040178 5.59240533z"
                  fill="#2563eb"
                  p-id="25407"
                  data-spm-anchor-id="a313x.search_index.0.i28.323b3a81mlEN19"
                  class="selected"
                ></path>
                <path
                  d="M465.39662222 676.50992355a34.95253333 34.95253333 0 1 1 0-69.90506666c40.54493867 0 48.70052978-7.92257422 49.86561423-9.55369244s6.52447289-12.582912-3.96128712-53.36086756a34.25348267 34.25348267 0 0 1 5.35938845-29.12711111 34.71951645 34.71951645 0 0 1 25.63185777-14.680064 288.24189155 288.24189155 0 0 0 107.88681956-26.56392533 107.42078578 107.42078578 0 0 0-10.01972622-9.55369245c-85.05116445-69.90506667-146.10158933-151.22796089-188.04462934-332.51510045a34.95253333 34.95253333 0 1 1 67.57489778-15.37911466c37.51571911 163.11182222 88.77943467 231.15275378 164.50992356 294.30033066 40.07890489 33.554432 41.01097245 63.61361067 34.95253333 83.18702934-14.21403022 44.73924267-82.25496178 63.84662755-133.28566044 72.00221866a98.566144 98.566144 0 0 1-16.07816533 74.79842134c-24.93280711 32.15633067-69.206016 36.35063467-104.39156623 36.35063466z m186.41351111-198.76340622zM544.38934755 935.624704a36.58365155 36.58365155 0 0 1-15.61213155-3.72827022 35.18555022 35.18555022 0 0 1-15.61213155-46.60337778 79.45875911 79.45875911 0 0 0 8.62162488-65.24472889 101.59536355 101.59536355 0 0 0-63.84662755-46.60337778 34.95253333 34.95253333 0 1 1 21.90358755-66.40981333A163.11182222 163.11182222 0 0 1 586.33238755 791.62026667a145.40253867 145.40253867 0 0 1-10.71877688 123.731968 34.95253333 34.95253333 0 0 1-31.22426312 20.27246933zM341.19862045 929.333248a279.62026667 279.62026667 0 0 1 0-559.24053333 34.95253333 34.95253333 0 0 1 0 69.90506666 209.7152 209.7152 0 0 0 0 419.4304 34.95253333 34.95253333 0 0 1 0 69.90506667z"
                  fill="#2563eb"
                  p-id="25408"
                  data-spm-anchor-id="a313x.search_index.0.i27.323b3a81mlEN19"
                  class=""
                ></path>
              </svg>
              {% elif plan.type == 'pain' %}
              <svg
                class="w-5 h-5 text-red-500"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13 10V3L4 14h7v7l9-11h-7z"
                />
              </svg>
              {% elif plan.type == 'step' %}
              <svg
                t="1765677734279"
                class="icon w-5 h-5"
                viewBox="0 0 1024 1024"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
                p-id="4114"
                width="32"
                height="32"
              >
                <path
                  d="M742.4 992h-12.8c-25.6 0-51.2-12.8-64-32l-281.6-307.2-6.4-6.4c-6.4-19.2-12.8-25.6-12.8-38.4 0-12.8 0-25.6 6.4-38.4l12.8-51.2-38.4 12.8c0 6.4 6.4 19.2 6.4 32s-6.4 19.2-6.4 32l-25.6 25.6c-12.8 12.8-19.2 12.8-32 19.2-19.2 6.4-44.8 6.4-64-6.4-12.8 0-19.2-12.8-32-19.2-6.4-6.4-12.8-19.2-12.8-32l-25.6-83.2c-6.4-19.2-6.4-38.4 6.4-57.6 6.4-19.2 19.2-32 38.4-44.8l12.8-6.4c19.2-6.4 134.4-57.6 236.8-102.4 32-12.8 51.2-25.6 51.2-25.6-6.4-6.4-12.8-19.2-19.2-25.6-19.2-25.6-25.6-44.8-25.6-70.4 0-38.4 19.2-70.4 44.8-96 25.6-25.6 57.6-38.4 96-38.4 25.6 0 51.2 12.8 70.4 25.6 19.2 12.8 38.4 38.4 44.8 57.6 6.4 25.6 6.4 51.2 6.4 76.8-6.4 25.6-19.2 44.8-38.4 64-19.2 19.2-32 25.6-51.2 32 12.8 6.4 19.2 19.2 25.6 38.4 6.4 19.2 12.8 44.8 6.4 64l-38.4 243.2 198.4 204.8c6.4 12.8 12.8 19.2 19.2 32 6.4 12.8 6.4 25.6 6.4 38.4 0 12.8-6.4 25.6-12.8 38.4-6.4 12.8-12.8 19.2-25.6 25.6-19.2 12.8-44.8 19.2-64 19.2zM435.2 428.8c6.4 0 12.8 0 19.2 6.4 6.4 12.8 12.8 25.6 12.8 32l-38.4 121.6V608l281.6 307.2c6.4 6.4 12.8 12.8 25.6 12.8s19.2 0 25.6-6.4c6.4 0 6.4-6.4 6.4-6.4 0-6.4 0-6.4 6.4-12.8v-12.8c0-6.4 0-6.4-6.4-12.8l-204.8-217.6c-6.4-6.4-12.8-19.2-6.4-25.6l44.8-262.4v-25.6c-12.8 0-12.8-6.4-25.6-12.8-6.4 0-6.4-6.4-6.4-6.4-6.4 0-12.8-6.4-19.2-6.4h-25.6s-19.2 6.4-51.2 19.2C403.2 377.6 256 441.6 243.2 448l-19.2 6.4c0 6.4-6.4 6.4-6.4 12.8v12.8l19.2 89.6 6.4 6.4h32l6.4-6.4v-6.4-6.4l-6.4-38.4c-6.4-12.8 6.4-25.6 19.2-32l128-51.2c0-6.4 6.4-6.4 12.8-6.4z m153.6-332.8c-19.2 0-32 6.4-44.8 19.2-12.8 12.8-25.6 32-25.6 51.2 0 12.8 6.4 25.6 12.8 38.4 6.4 12.8 19.2 19.2 32 25.6 12.8 6.4 25.6 6.4 38.4 6.4 12.8 0 25.6-6.4 32-19.2l19.2-38.4v-38.4c-6.4-12.8-12.8-19.2-25.6-32-12.8-6.4-19.2-12.8-38.4-12.8z"
                  fill="#3662EC"
                  p-id="4115"
                ></path>
                <path
                  d="M307.2 921.6h-12.8l-140.8-44.8c-25.6-6.4-38.4-25.6-51.2-44.8-6.4-19.2-6.4-44.8 0-64 0-6.4 6.4-19.2 12.8-25.6s12.8-19.2 25.6-25.6c6.4-6.4 19.2-12.8 25.6-12.8h32l51.2 19.2 19.2-32c6.4-12.8 19.2-19.2 32-25.6 12.8-6.4 25.6 0 38.4 6.4 6.4 0 12.8 6.4 12.8 12.8l57.6 64c6.4 12.8 12.8 19.2 12.8 32s0 25.6-12.8 32l-32 51.2c6.4 19.2-6.4 32-25.6 44.8-12.8 6.4-25.6 12.8-44.8 12.8z m-121.6-160c-6.4 0-12.8 0-12.8 6.4l-6.4 6.4s0 6.4-6.4 6.4v19.2c0 6.4 6.4 6.4 12.8 12.8l134.4 44.8s6.4 0 12.8-6.4c6.4 0 6.4-6.4 12.8-12.8l32-51.2-44.8-51.2-32 57.6-102.4-32zM800 595.2c-12.8 0-25.6 0-38.4-6.4l-64-32S672 544 672 512l12.8-89.6c6.4-19.2 12.8-25.6 25.6-32 6.4-6.4 19.2-6.4 32 0l12.8 6.4 89.6 38.4c6.4 0 12.8 6.4 19.2 12.8 6.4 6.4 12.8 19.2 19.2 32 6.4 12.8 6.4 25.6 6.4 32 0 12.8 0 25.6-6.4 32-6.4 12.8-12.8 19.2-19.2 25.6-6.4 6.4-19.2 12.8-32 19.2-12.8 6.4-19.2 6.4-32 6.4z m-64-89.6l57.6 25.6h19.2c6.4 0 6.4 0 6.4-6.4s6.4-6.4 6.4-6.4V512v-6.4s0-6.4-6.4-6.4l-6.4-6.4-70.4-32-6.4 44.8z m-19.2-6.4c6.4 0 0 0 0 0z m6.4-51.2z"
                  fill="#3662EC"
                  p-id="4116"
                ></path>
              </svg>
              {% elif plan.type == 'followup' %}
              <svg
                t="1765678143286"
                class="icon w-5 h-5"
                viewBox="0 0 1024 1024"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
                p-id="5267"
                width="32"
                height="32"
              >
                <path
                  d="M853.333333 938.666667H170.666667a85.333333 85.333333 0 0 1-85.333334-85.333334V298.666667a85.333333 85.333333 0 0 1 85.333334-85.333334h85.333333V170.666667a85.333333 85.333333 0 0 1 85.333333-85.333334h341.333334a85.333333 85.333333 0 0 1 85.333333 85.333334v42.666666h85.333333a85.333333 85.333333 0 0 1 85.333334 85.333334v554.666666a85.333333 85.333333 0 0 1-85.333334 85.333334zM405.333333 725.333333h74.666667v74.666667a32 32 0 0 0 64 0V725.333333H618.666667a32 32 0 0 0 0-64h-74.666667v-74.666666a32 32 0 0 0-64 0V661.333333H405.333333a32 32 0 0 0 0 64zM704 192a42.666667 42.666667 0 0 0-42.666667-42.666667H362.666667a42.666667 42.666667 0 0 0-42.666667 42.666667v21.333333h384V192z m138.666667 192h-661.333334a32 32 0 0 0 0 64h661.333334a32 32 0 0 0 0-64z"
                  fill="#FCBD3F"
                  p-id="5268"
                ></path>
              </svg>
              {% elif plan.type == 'checkup' %}
              <svg
                t="1765678294219"
                class="icon w-5 h-5"
                viewBox="0 0 1029 1024"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
                p-id="13235"
                width="32"
                height="32"
              >
                <path
                  d="M372.224 951.808H118.784C56.32 951.296 5.12 900.608 5.12 838.144V113.664C5.12 51.2 56.32 0 118.784 0h579.584c62.464 0 113.664 51.2 113.664 113.664v217.088c0.512 22.528-17.408 41.472-39.936 42.496h-1.536c-22.528 0-40.448-17.408-41.472-39.936V113.664c0-17.408-13.824-31.232-31.232-31.232H118.784c-17.408 0-31.232 13.824-31.232 31.232v723.968c0 17.408 13.824 31.232 31.232 31.232h254.464c22.528 0 40.448 17.408 41.472 39.936 0.512 22.528-17.408 41.984-39.936 42.496h-1.536l-1.024 0.512z"
                  p-id="13236"
                  fill="#2563eb"
                ></path>
                <path
                  d="M191.488 517.12c-11.264-0.512-21.504-5.12-29.184-12.8-7.68-8.192-11.264-18.432-11.264-29.696 0.512-21.504 18.432-39.424 39.936-39.936h181.248c23.04 0.512 40.96 19.968 39.936 42.496-0.512 21.504-18.432 39.424-39.936 39.936H191.488z m-1.536-217.088c-22.528 0-40.448-17.408-41.472-39.936-0.512-11.264 3.584-21.504 11.264-29.696 7.68-8.192 17.92-12.8 28.672-12.8h438.272c22.528 0 40.448 17.408 41.472 39.936 0.512 22.528-17.408 41.984-39.936 42.496H189.952z m491.52 568.32c0 22.016 17.92 39.936 39.936 39.936s39.936-17.92 39.936-39.936-17.92-39.936-39.936-39.936-39.936 17.92-39.936 39.936z m39.424-351.232c-22.016 0-39.936 17.92-39.936 39.936v198.656c0 22.016 17.92 39.936 39.936 39.936s39.936-17.92 39.936-39.936v-198.656c0-22.016-17.92-39.936-39.936-39.936z"
                  p-id="13237"
                  fill="#2563eb"
                ></path>
                <path
                  d="M716.288 1024c-173.056 0-313.344-140.288-313.344-312.832 0-83.456 32.256-162.304 91.648-221.696 58.88-59.392 137.728-91.648 221.184-92.16 173.056 0 313.344 140.288 313.344 312.832 0 83.968-32.256 162.304-91.648 221.696-57.856 58.368-137.728 91.648-220.16 91.648h-1.024z m0-542.72c-126.976 0-230.4 103.424-230.4 230.4s103.424 230.4 230.4 230.4 230.4-103.424 230.4-230.4c0-125.44-100.352-227.84-225.28-230.4h-5.12z"
                  p-id="13238"
                  fill="#2563eb"
                ></path>
              </svg>
              {% else %}
              <svg
                class="w-5 h-5 text-amber-500"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                />
              </svg>
              {% endif %}
            </div>
            <div>
              <h4 class="font-bold text-slate-800 text-sm">{{ plan.title }}</h4>
              <p class="text-sm text-slate-500 mt-0.5">{{ plan.subtitle }}</p>
            </div>
          </div>
          {% if plan.status != 'completed' %}
          <!-- 核心修改：直接使用后端生成的auth_url跳转 window.location.href='{{ plan.auth_url }}'-->
          {% comment %}
          <button
            onclick="handleTaskClick(plan.title,plan.type)"
            class="bg-white border border-slate-200 text-slate-600 text-sm font-bold px-3 py-1.5 rounded-full shadow-sm hover:border-blue-400 hover:text-blue-600 active:bg-blue-50 transition whitespace-nowrap"
          >
            {{ plan.action_text }}
          </button>
          {% endcomment %}

          <button
            onclick="handleTaskClick('{{ plan.title }}', '{{ plan.type }}')"
            class="bg-white border border-slate-200 text-slate-600 text-sm font-bold px-3 py-1.5 rounded-full shadow-sm hover:border-blue-400 hover:text-blue-600 active:bg-blue-50 transition whitespace-nowrap"
          >
            {{ plan.action_text }}
          </button>

          {% endif %}
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="flex flex-col items-center justify-center py-10">
        <div class="flex items-center justify-center mb-3">
                      <svg t="1765808670850" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8014" width="64" height="64"><path d="M35.698301 77.721345h59.476898c4.135408 0 7.419408 3.284 7.419408 7.419408s-3.284 7.419408-7.419408 7.419409H35.698301c-4.135408 0-7.419408-3.284-7.419408-7.419409s3.284-7.419408 7.419408-7.419408z m0 0" fill="#F4C15B" p-id="8015"></path><path d="M65.497565 47.922081c4.135408 0 7.419408 3.284 7.419409 7.419408v59.476898c0 4.135408-3.284 7.419408-7.419409 7.419408-4.135408 0-7.419408-3.284-7.419408-7.419408V55.341489c0-4.135408 3.284-7.419408 7.419408-7.419408z m0 0" fill="#F4C15B" p-id="8016"></path><path d="M362.030645 116.277943l28.704597 7.662668c4.013778 1.094667 6.324742 5.108445 5.230075 9.122223-1.094667 4.013778-5.108445 6.324742-9.122224 5.230075l-28.704597-7.662668c-4.013778-1.094667-6.324742-5.108445-5.230075-9.122223 1.216296-3.892149 5.108445-6.324742 9.122224-5.230075z m0 0" fill="#4680E8" p-id="8017"></path><path d="M414.939542 74.558974l7.662667 28.704596c1.094667 4.013778-1.216296 8.027557-5.230075 9.122224-4.013778 1.094667-8.027557-1.216296-9.122223-5.230075L400.587243 78.329493c-1.094667-4.013778 1.216296-8.027557 5.230075-9.122224 4.013778-0.973037 8.149186 1.337926 9.122224 5.351705z m0 0" fill="#8FB3FF" p-id="8018"></path><path d="M477.57881 99.493051L456.536881 120.53498c-2.919112 2.919112-7.541038 2.919112-10.46015 0-2.919112-2.919112-2.919112-7.541038 0-10.460149l21.041929-21.041929c2.919112-2.919112 7.541038-2.919112 10.46015 0 2.919112 2.797482 2.919112 7.541038 0 10.460149z m0 0" fill="#ABC3EF" p-id="8019"></path><path d="M927.000356 113.358831c-24.569189 0-44.516451 19.947262-44.516451 44.638081 0 24.569189 19.947262 44.516451 44.516451 44.516451 24.569189 0 44.638081-19.947262 44.638081-44.516451-0.12163-24.690818-20.068892-44.638081-44.638081-44.638081z m0 74.315715c-16.420002 0-29.799264-13.379261-29.799263-29.799264s13.379261-29.799264 29.799263-29.799263 29.799264 13.379261 29.799264 29.799263c-0.12163 16.541632-13.500891 29.799264-29.799264 29.799264z m0 0" fill="#F4C15B" p-id="8020"></path><path d="M905.715168 374.984202l-446.137546-59.476897v235.718256l446.137546 46.827414V374.984202z m0 0" fill="#4680E8" p-id="8021"></path><path d="M102.594607 392.742131l356.861385-77.113196v267.706853L102.594607 660.448984V392.742131z m0 0" fill="#8FB3FF" p-id="8022"></path><path d="M519.05452 482.018292l386.660648-106.91246V880.598646l-386.660648 106.91246V482.018292z m0 0" fill="#4680E8" p-id="8023"></path><path d="M102.594607 392.742131l416.338283 89.276161v502.816962L102.594607 883.517757V392.742131z m0 0" fill="#8FB3FF" p-id="8024"></path><path d="M519.05452 481.166884L102.594607 392.742131l-89.276161 178.430692 431.298729 101.317497 74.437345-191.323436z m0 0" fill="#ABC3EF" p-id="8025"></path><path d="M756.597221 28.461337L711.95914 46.584155v59.476897l44.638081-18.122817V28.461337z m0 0" fill="#F4C15B" p-id="8026"></path><path d="M659.780021 87.938235l44.638081 18.122817V46.584155l-44.638081-18.122818v59.476898z m96.8172-65.43675L708.796769 3.648889l-48.895118 16.906521 48.773489 20.67704 47.922081-18.730965z m0 0" fill="#E5CF6E" p-id="8027"></path><path d="M519.05452 482.018292l386.660648-106.91246 104.114978 178.430693-371.821831 121.751276-118.953795-193.269509z m0 0" fill="#8FB3FF" p-id="8028"></path><path d="M728.257513 388.241834S744.799145 283.883597 831.156194 231.947737c0 0 7.541038 8.514075 22.623115 27.853189 0 0-39.408006-6.203112-125.521796 128.440908z m0 0" fill="#ABC3EF" p-id="8029"></path><path d="M519.05452 383.984796s1.702815-57.165934 43.543413-186.09336c0 0 7.541038 8.514075 22.623115 27.853189-0.12163 0-15.933484 13.74415-66.166528 158.240171z m0 0" fill="#8FB3FF" p-id="8030"></path><path d="M373.585461 373.646276S326.514788 235.231738 211.209882 172.835729c0 0-19.217484 27.001782-40.381042 35.515857-0.12163 0 132.697945 46.219266 202.756621 165.29469z m0 0" fill="#E5CF6E" p-id="8031"></path></svg>
        </div>
        <p class="text-slate-500 font-medium text-sm">今日暂无计划</p>
        <p class="text-slate-400 text-sm mt-0.5">请联系医生为您制定康复计划</p>
      </div>
      {% endif %}
    </div>
  </div>

  <!-- Medication Reminder Modal -->
  <div
    id="medication-modal"
    class="fixed inset-0 z-50"
    style="display: none; background: rgba(0, 0, 0, 0.9)"
  >
    <div
      class="relative min-h-screen flex flex-col items-center justify-center p-4"
    >
      <div
        class="w-full max-w-[300px] bg-white rounded-3xl p-6 shadow-2xl relative animate-bounce-in flex flex-col items-center"
      >
        <div class="absolute left-1/2 -translate-x-1/2" style="top: -30px">
          <div
            class="w-20 h-20 bg-blue-600 rounded-full flex items-center justify-center shadow-lg shadow-blue-200 border-4"
          >
            <svg
              t="1765638657220"
              class="icon w-10 h-10"
              viewBox="0 0 1024 1024"
              version="1.1"
              xmlns="http://www.w3.org/2000/svg"
              p-id="13348"
              width="48"
              height="48"
            >
              <path
                d="M936.947489 506.802877L726.956399 716.793967 307.230172 296.811787l209.99109-209.698573a296.576307 296.576307 0 0 1 419.726227 0 296.576307 296.576307 0 0 1 0 419.689663z m-128.634625-354.165715c-73.568183-75.688935-157.740129-75.688935-236.537065-1.096941L454.183714 272.167177a37.222868 37.222868 0 0 0-9.214305 35.321503c3.290823 12.651387 12.870776 22.523857 25.156515 25.924374a35.102115 35.102115 0 0 0 34.407386-9.470258l116.604838-119.603144c50.093643-47.460985 90.753593-47.460985 136.861684 0a34.919291 34.919291 0 0 0 34.590209 9.9456 35.906538 35.906538 0 0 0 25.412469-26.107198 37.149738 37.149738 0 0 0-9.689646-35.540892z m-301.512542 784.349447a296.686001 296.686001 0 0 1-419.726228 0 296.722566 296.722566 0 0 1 0-419.726227L297.065184 307.269292l419.726228 419.689662-209.99109 210.027655z"
                fill="#ffffff"
                p-id="13349"
              ></path>
            </svg>
          </div>
        </div>

        <div class="text-center" style="margin-top: 50px">
          <p class="text-slate-600 text-lg leading-relaxed font-semibold">
            为确保您药物使用的安全规范，请核对用药，如有不同请及时和管理医生沟通！
          </p>
        </div>

        <div class="mt-6 w-full mb-3">
          <button
            onclick="submitMedication()"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-full shadow-lg shadow-blue-200 active:scale-95 transition-transform"
          >
            我已按时服药
          </button>
        </div>
      </div>

      <div class="mt-8">
        <button
          onclick="closeMedicationModal()"
          class="w-16 h-16 rounded-full bg-white border border-white/40 flex items-center justify-center backdrop-blur-md active:bg-white/30 transition"
        >
          <svg
            class="w-8 h-8"
            fill="#000000"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"
            />
          </svg>
        </button>
      </div>
    </div>
  </div>
</div>

<script>
function openMedicationModal() {
    const modal = document.getElementById('medication-modal');
    modal.classList.remove('hidden');
    modal.style.display = 'block'; // Ensure it's visible if hidden class toggle isn't enough
}

function closeMedicationModal() {
    const modal = document.getElementById('medication-modal');
    modal.classList.add('hidden');
    modal.style.display = 'none';
}

function submitMedication() {
    const openid = "{{ user.wx_openid }}";
    window.location.href = "{% url 'web_patient:patient_home' %}?openid=" + openid + "&medication_taken=true";
}

function handleTaskClick(title, type) {
    // 获取当前用户openid
    const patientId = "{{ patient_id|default:'' }}";
    
    // 获取后端传递的菜单URL映射
    const menuUrls = {{ menuUrl|safe }};
    
    if(title.includes('用药提醒')){
        openMedicationModal();
    } else  {
       let urlA = menuUrls[type];
       console.log("跳转地址:", urlA);
       
       if (urlA) {
            // 判断URL是否已经包含参数
            const separator = urlA.includes('?') ? '&' : '?';
            window.location.href = urlA + separator + "patient_id=" + "12";
       } else {
            console.error("未找到对应类型的跳转链接:", type);
            // 可以在这里添加默认跳转或提示
       }
    } 
}
</script>
{% endblock %}
