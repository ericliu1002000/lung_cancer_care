{% extends "layouts/base_sales.html" %}
{% load static %}
{% block body %}
  <div class="flex-1 flex overflow-hidden relative">
    <div
      class="fixed inset-0 bg-black/40 z-30 md:hidden"
      x-show="sidebarOpen"
      x-transition.opacity
      @click="sidebarOpen = false"
      x-cloak
    ></div>

    <aside
      data-ws-sidebar
      class="fixed inset-y-0 left-0 z-40 w-72 bg-slate-900 text-white flex flex-col transform transition-transform duration-200 md:relative md:translate-x-0 md:z-0"
      :class="{'-translate-x-full': !sidebarOpen, 'translate-x-0': sidebarOpen}"
    >
      <div class="px-4 py-3 border-b border-white/10 flex items-center justify-between md:hidden">
        <span class="font-semibold">导航</span>
        <button class="ws-tap-target text-white ws-active-bg-dark rounded-xl" @click="sidebarOpen = false" aria-label="关闭导航">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>

      <div class="flex-1 overflow-y-auto p-4 space-y-6">
        <div class="bg-white/5 rounded-2xl border border-white/5" x-data="{ open: true }">
          <button
            type="button"
            class="ws-tap-target w-full flex items-center justify-between px-4 py-3 text-left font-medium tracking-wide ws-active-bg-dark rounded-2xl"
            @click="open = !open"
          >
            <span>我的医生</span>
            <svg class="w-4 h-4 transition-transform duration-200" :class="{'rotate-180': open}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 9l6 6 6-6" />
            </svg>
          </button>
          <div x-show="open" x-transition>
            <div class="px-4 pb-4 space-y-3">
              <div class="relative">
                <span class="absolute inset-y-0 left-3 flex items-center text-slate-400">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 110-15 7.5 7.5 0 010 15z" />
                  </svg>
                </span>
                <input type="search" placeholder="搜索医生..." class="ws-tap-target w-full bg-white/10 border border-white/10 rounded-xl pl-9 pr-3 py-2 text-sm placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-300/40">
              </div>
              <div data-ws-scroll-list class="overflow-y-auto divide-y divide-white/5">
                {% if doctors %}
                  {% for doctor in doctors %}
                  <div
                    class="ws-tap-target py-3 px-2 rounded-xl transition cursor-pointer ws-active-bg-dark"
                    hx-get="{% url 'web_sales:doctor_detail' doctor.id %}"
                    hx-target="#main-content-area"
                    hx-swap="innerHTML"
                    @click="sidebarOpen = false"
                  >
                    <div class="text-sm font-semibold">{{ doctor.name }}</div>
                    <div class="text-sm text-white/70 mt-1">{{ doctor.hospital }}</div>
                  </div>
                  {% endfor %}
                {% else %}
                  <div class="text-center text-white/50 text-sm py-6">暂无医生</div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>

        <div class="bg-white/5 rounded-2xl border border-white/5" x-data="{ open: true }">
          <button
            type="button"
            class="ws-tap-target w-full flex items-center justify-between px-4 py-3 text-left font-medium tracking-wide ws-active-bg-dark rounded-2xl"
            @click="open = !open"
          >
            <span>我的患者</span>
            <svg class="w-4 h-4 transition-transform duration-200" :class="{'rotate-180': open}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 9l6 6 6-6" />
            </svg>
          </button>
          <div x-show="open" x-transition>
            <div class="px-4 pb-4 space-y-3">
              <div class="relative">
                <span class="absolute inset-y-0 left-3 flex items-center text-slate-400">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 110-15 7.5 7.5 0 010 15z" />
                  </svg>
                </span>
                <input type="search" placeholder="搜索患者..." class="ws-tap-target w-full bg-white/10 border border-white/10 rounded-xl pl-9 pr-3 py-2 text-sm placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-300/40">
              </div>
              <div data-ws-scroll-list class="overflow-y-auto divide-y divide-white/5">
                {% if patients %}
                  {% for patient in patients %}
                  <div
                    class="ws-tap-target py-3 px-2 rounded-xl transition cursor-pointer space-y-1 ws-active-bg-dark"
                    hx-get="{% url 'web_sales:patient_detail' patient.id %}"
                    hx-target="#main-content-area"
                    hx-swap="innerHTML"
                    @click="sidebarOpen = false"
                  >
                    <div class="text-sm font-semibold">{{ patient.name }}</div>
                    <div class="flex items-center justify-between text-sm text-white/70">
                      <span>
                        {% if patient.claim_status == 0 %}
                        <span class="inline-flex items-center px-2 py-0.5 rounded-full bg-amber-400/30 text-amber-200">
                          待认领
                        </span>
                        {% endif %}
                      </span>
                      <span class="inline-flex items-center px-2 py-0.5 rounded-full bg-emerald-400/20 text-emerald-200">
                        {{ patient.get_service_status_display }}
                      </span>
                    </div>
                  </div>
                  {% endfor %}
                {% else %}
                  <div class="text-center text-white/50 text-sm py-6">暂无患者</div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>
    </aside>

    <main id="main-content-area" data-ws-safe-bottom class="flex-1 overflow-y-auto bg-gray-50">
      {% include "web_sales/partials/dashboard_home.html" %}
    </main>
  </div>
{% endblock %}
