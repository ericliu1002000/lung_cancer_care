<!DOCTYPE html>
<!-- saved from url=(0047)http://eric.dagimed.com/static/docs/report.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>requirements</title>
      
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="./requirements_files/katex.min.css">
      
      
      <script src="./requirements_files/mermaid.min.js.下载"></script>
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}

      </style>
      <style data-id="immersive-translate-input-injected-css">.immersive-translate-input {
  position: absolute;
  top: 0;
  right: 0;
  left: 0;
  bottom: 0;
  z-index: 2147483647;
  display: flex;
  justify-content: center;
  align-items: center;
}
.immersive-translate-attach-loading::after {
  content: " ";

  --loading-color: #f78fb6;
  width: 6px;
  height: 6px;
  border-radius: 50%;
  display: block;
  margin: 12px auto;
  position: relative;
  color: white;
  left: -100px;
  box-sizing: border-box;
  animation: immersiveTranslateShadowRolling 1.5s linear infinite;

  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-2000%, -50%);
  z-index: 100;
}

.immersive-translate-loading-spinner {
  vertical-align: middle !important;
  width: 10px !important;
  height: 10px !important;
  display: inline-block !important;
  margin: 0 4px !important;
  border: 2px rgba(221, 244, 255, 0.6) solid !important;
  border-top: 2px rgba(0, 0, 0, 0.375) solid !important;
  border-left: 2px rgba(0, 0, 0, 0.375) solid !important;
  border-radius: 50% !important;
  padding: 0 !important;
  -webkit-animation: immersive-translate-loading-animation 0.6s infinite linear !important;
  animation: immersive-translate-loading-animation 0.6s infinite linear !important;
}

@-webkit-keyframes immersive-translate-loading-animation {
  from {
    -webkit-transform: rotate(0deg);
  }

  to {
    -webkit-transform: rotate(359deg);
  }
}

@keyframes immersive-translate-loading-animation {
  from {
    transform: rotate(0deg);
  }

  to {
    transform: rotate(359deg);
  }
}

.immersive-translate-input-loading {
  --loading-color: #f78fb6;
  width: 6px;
  height: 6px;
  border-radius: 50%;
  display: block;
  margin: 12px auto;
  position: relative;
  color: white;
  left: -100px;
  box-sizing: border-box;
  animation: immersiveTranslateShadowRolling 1.5s linear infinite;
}

@keyframes immersiveTranslateShadowRolling {
  0% {
    box-shadow: 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0),
      0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
  }

  12% {
    box-shadow: 100px 0 var(--loading-color), 0px 0 rgba(255, 255, 255, 0),
      0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
  }

  25% {
    box-shadow: 110px 0 var(--loading-color), 100px 0 var(--loading-color),
      0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
  }

  36% {
    box-shadow: 120px 0 var(--loading-color), 110px 0 var(--loading-color),
      100px 0 var(--loading-color), 0px 0 rgba(255, 255, 255, 0);
  }

  50% {
    box-shadow: 130px 0 var(--loading-color), 120px 0 var(--loading-color),
      110px 0 var(--loading-color), 100px 0 var(--loading-color);
  }

  62% {
    box-shadow: 200px 0 rgba(255, 255, 255, 0), 130px 0 var(--loading-color),
      120px 0 var(--loading-color), 110px 0 var(--loading-color);
  }

  75% {
    box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0),
      130px 0 var(--loading-color), 120px 0 var(--loading-color);
  }

  87% {
    box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0),
      200px 0 rgba(255, 255, 255, 0), 130px 0 var(--loading-color);
  }

  100% {
    box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0),
      200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0);
  }
}

.immersive-translate-modal {
  position: fixed;
  z-index: 2147483647;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgb(0, 0, 0);
  background-color: rgba(0, 0, 0, 0.4);
  font-size: 15px;
}

.immersive-translate-modal-content {
  background-color: #fefefe;
  margin: 10% auto;
  padding: 40px 24px 24px;
  border-radius: 12px;
  width: 350px;
  font-family: system-ui, -apple-system, "Segoe UI", "Roboto", "Ubuntu",
    "Cantarell", "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji",
    "Segoe UI Symbol", "Noto Color Emoji";
  position: relative;
}

@media screen and (max-width: 768px) {
  .immersive-translate-modal-content {
    margin: 25% auto !important;
  }
}

@media screen and (max-width: 480px) {
  .immersive-translate-modal-content {
    width: 80vw !important;
    margin: 20vh auto !important;
    padding: 20px 12px 12px !important;
  }

  .immersive-translate-modal-title {
    font-size: 14px !important;
  }

  .immersive-translate-modal-body {
    font-size: 13px !important;
    max-height: 60vh !important;
  }

  .immersive-translate-btn {
    font-size: 13px !important;
    padding: 8px 16px !important;
    margin: 0 4px !important;
  }

  .immersive-translate-modal-footer {
    gap: 6px !important;
    margin-top: 16px !important;
  }
}

.immersive-translate-modal .immersive-translate-modal-content-in-input {
  max-width: 500px;
}
.immersive-translate-modal-content-in-input .immersive-translate-modal-body {
  text-align: left;
  max-height: unset;
}

.immersive-translate-modal-title {
  text-align: center;
  font-size: 16px;
  font-weight: 700;
  color: #333333;
}

.immersive-translate-modal-body {
  text-align: center;
  font-size: 14px;
  font-weight: 400;
  color: #333333;
  margin-top: 24px;
}

@media screen and (max-width: 768px) {
  .immersive-translate-modal-body {
    max-height: 250px;
    overflow-y: auto;
  }
}

.immersive-translate-close {
  color: #666666;
  position: absolute;
  right: 16px;
  top: 16px;
  font-size: 20px;
  font-weight: bold;
}

.immersive-translate-close:hover,
.immersive-translate-close:focus {
  text-decoration: none;
  cursor: pointer;
}

.immersive-translate-modal-footer {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  margin-top: 24px;
}

.immersive-translate-btn {
  width: fit-content;
  color: #fff;
  background-color: #ea4c89;
  border: none;
  font-size: 14px;
  margin: 0 8px;
  padding: 9px 30px;
  border-radius: 5px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.immersive-translate-btn-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.immersive-translate-btn:hover {
  background-color: #f082ac;
}
.immersive-translate-btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}
.immersive-translate-btn:disabled:hover {
  background-color: #ea4c89;
}

.immersive-translate-link-btn {
  background-color: transparent;
  color: #ea4c89;
  border: none;
  cursor: pointer;
  height: 30px;
  line-height: 30px;
}

.immersive-translate-cancel-btn {
  /* gray color */
  background-color: rgb(89, 107, 120);
}

.immersive-translate-cancel-btn:hover {
  background-color: hsl(205, 20%, 32%);
}

.immersive-translate-action-btn {
  background-color: transparent;
  color: #ea4c89;
  border: 1px solid #ea4c89;
}

.immersive-translate-btn svg {
  margin-right: 5px;
}

.immersive-translate-link {
  cursor: pointer;
  user-select: none;
  -webkit-user-drag: none;
  text-decoration: none;
  color: #ea4c89;
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
}

.immersive-translate-primary-link {
  cursor: pointer;
  user-select: none;
  -webkit-user-drag: none;
  text-decoration: none;
  color: #ea4c89;
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
}

.immersive-translate-modal input[type="radio"] {
  margin: 0 6px;
  cursor: pointer;
}

.immersive-translate-modal label {
  cursor: pointer;
}

.immersive-translate-close-action {
  position: absolute;
  top: 2px;
  right: 0px;
  cursor: pointer;
}

.imt-image-status {
  background-color: rgba(0, 0, 0, 0.5) !important;
  display: flex !important;
  flex-direction: column !important;
  align-items: center !important;
  justify-content: center !important;
  border-radius: 16px !important;
}
.imt-image-status img,
.imt-image-status svg,
.imt-img-loading {
  width: 28px !important;
  height: 28px !important;
  margin: 0 0 8px 0 !important;
  min-height: 28px !important;
  min-width: 28px !important;
  position: relative !important;
}
.imt-img-loading {
  background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAAA4CAMAAACfWMssAAAAtFBMVEUAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////oK74hAAAAPHRSTlMABBMIDyQXHwyBfFdDMSw+OjXCb+5RG51IvV/k0rOqlGRM6KKMhdvNyZBz9MaupmxpWyj437iYd/yJVNZeuUC7AAACt0lEQVRIx53T2XKiUBCA4QYOiyCbiAsuuGBcYtxiYtT3f6/pbqoYHVFO5r+iivpo6DpAWYpqeoFfr9f90DsYAuRSWkFnPO50OgR9PwiCUFcl2GEcx+N/YBh6pvKaefHlUgZd1zVe0NbYcQjGBfzrPE8Xz8aF+71D8gG6DHFPpc4a7xFiCDuhaWgKgGIJQ3d5IMGDrpS4S5KgpIm+en9f6PlAhKby4JwEIxlYJV9h5k5nee9GoxHJ2IDSNB0dwdad1NAxDJ/uXDHYmebdk4PdbkS58CIVHdYSUHTYYRWOJblWSyu2lmy3KNFVJNBhxcuGW4YBVCbYGRZwIooipHsNqjM4FbgOQqQqSKQQU9V8xmi1QlgHqQQ6DDBvRUVCDirs+EzGDGOQTCATgtYTnbCVLgsVgRE0T1QE0qHCFAht2z6dLvJQs3Lo2FQoDxWNUiBhaP4eRgwNkI+dAjVOA/kUrIDwf3CG8NfNOE0eiFotSuo+rBiq8tD9oY4Qzc6YJw99hl1wzpQvD7ef2M8QgnOGJfJw+EltQc+oX2yn907QB22WZcvlUpd143dqQu+8pCJZuGE4xCuPXJqqcs5sNpsI93Rmzym1k4Npk+oD1SH3/a3LOK/JpUBpWfqNySxWzCfNCUITuDG5dtuphrUJ1myeIE9bIsPiKrfqTai5WZxbhtNphYx6GEIHihyGFTI69lje/rxajdh0s0msZ0zYxyPLhYCb1CyHm9Qsd2H37Y3lugVwL9kNh8Ot8cha6fUNQ8nuXi5z9/ExsAO4zQrb/ev1yrCB7lGyQzgYDGuxq1toDN/JGvN+HyWNHKB7zEoK+PX11e12G431erGYzwmytAWU56fkMHY5JJnDRR2eZji3AwtIcrEV8Cojat/BdQ7XOwGV1e1hDjGGjXbdArm8uJZtCH5MbcctVX8A1WpqumJHwckAAAAASUVORK5CYII=");
  background-size: 28px 28px;
  animation: image-loading-rotate 1s linear infinite !important;
}

.imt-image-status span {
  color: var(--bg-2, #fff) !important;
  font-size: 14px !important;
  line-height: 14px !important;
  font-weight: 500 !important;
  font-family: "PingFang SC", Arial, sans-serif !important;
}

.imt-primary-button {
  display: flex;
  padding: 12px 80px;
  justify-content: center;
  align-items: center;
  gap: 8px;
  border-radius: 8px;
  background: #ea4c89;
  color: #fff;
  font-size: 16px;
  font-style: normal;
  font-weight: 700;
  line-height: 24px;
  border: none;
  cursor: pointer;
}

.imt-retry-text {
  color: #999;
  text-align: center;
  font-size: 14px;
  font-style: normal;
  font-weight: 400;
  line-height: 21px;
  cursor: pointer;
}

.imt-action-container {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.imt-modal-content-text {
  text-align: left;
  color: #333;
  font-size: 16px;
  font-weight: 400;
  line-height: 24px;
}

@keyframes image-loading-rotate {
  from {
    transform: rotate(360deg);
  }
  to {
    transform: rotate(0deg);
  }
}

.imt-linear-gradient-text {
  background: linear-gradient(90deg, #00a6ff 0%, #c369ff 52.4%, #ff4590 100%);
  background-clip: text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.imt-flex-center {
  display: flex;
  align-items: center;
  justify-content: center;
}

.imt-linear-black-btn {
  border-radius: 50px;
  background: linear-gradient(66deg, #222 19%, #696969 94.25%);
  height: 48px;
  width: 100%;
  color: #fff;
  font-size: 16px;
  font-weight: 700;
  display: flex;
  align-items: center;
  cursor: pointer;
  justify-content: center;
}
</style></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="诊疗记录与图片档案需求说明整理版">诊疗记录与图片档案需求说明（整理版） </h1>
<h2 id="1-目标与范围">1. 目标与范围 </h2>
<ul>
<li>诊疗记录作为患者电子病历卡，承载门诊、复查、住院历史；V1 以图片报告存档为主。</li>
<li>覆盖医生端（患者主页/工作台）与患者端（复查计划任务、个人中心上传）。</li>
<li>图片数据来源：患者自主上传或医生后台录入。</li>
<li>核心流程为“上传 + 归档”，并确保时间维度和档案状态可追溯。</li>
</ul>
<h2 id="2-核心概念与字段定义">2. 核心概念与字段定义 </h2>
<ul>
<li>诊疗记录：按“记录类型 + 报告日期”组织的医疗记录条目，可关联多张报告图片。</li>
<li>图片档案：患者上传的原始图片库，按“上传日期”索引，支持归档/未归档状态。</li>
<li>上传记录：患者端上传行为的记录载体（与图片档案一一或一对多）。</li>
<li>日期定义：
<ul>
<li>报告日期：报告上出具结果的日期（用于诊疗记录主索引）。</li>
<li>归档日期：医生将图片归档到“报告类型 + 报告日期”的日期。</li>
<li>上传日期：患者或医生实际上传图片的日期。</li>
</ul>
</li>
<li>记录类型（一级类目）：门诊、复查、住院。</li>
<li>复查二级类目：血常规、血生化、胸部CT、骨扫描、头颅MR、心脏彩超、心电图、凝血功能、甲状腺功能、肿瘤评估、肿瘤标志物、其他。</li>
</ul>
<h2 id="3-角色与权限边界">3. 角色与权限边界 </h2>
<ul>
<li>患者/家属：上传报告、查看诊疗记录与图片档案、删除自己的上传记录。</li>
<li>医生/助理：新增诊疗记录、归档图片、批量归档、删除诊疗记录。</li>
<li>平台医生删除诊疗记录时，只影响归档关系，不删除患者原始图片。</li>
</ul>
<h2 id="4-业务流程">4. 业务流程 </h2>
<h3 id="41-医生新增诊疗记录">4.1 医生新增诊疗记录 </h3>
<ul>
<li>入口：医生端患者主页中的“诊疗记录”Tab。</li>
<li>新增记录时必须选择记录类型与报告日期；医院/科室为可选。</li>
<li>备注/解读为必填，字数上限 500（来自配图交互）。</li>
<li>医生新增记录视为“上传 + 归档”同时完成：
<ul>
<li>归档日期 = 上传日期（除非后续二次归档调整）。</li>
<li>报告日期会写入关联图片的报告日期。</li>
</ul>
</li>
<li>记录类型为“复查”时，必须选择复查二级类目。</li>
<li>图片上传校验（医生端）：至少 1 张，每张需选择一级类目；若为“复查”必须选二级类目；单张不超过 10MB。</li>
</ul>
<h3 id="42-患者上传报告">4.2 患者上传报告 </h3>
<ul>
<li>入口：
<ul>
<li>复查计划任务入口（自带类目信息）。</li>
<li>个人中心上传报告入口（默认标记为“未分类”）。</li>
</ul>
</li>
<li>系统记录上传日期。</li>
<li>患者可删除“上传报告”中的上传记录；后台同步删除对应上传记录。</li>
<li>若上传记录已被医生归档：
<ul>
<li>上传记录可删除，但已归档的图片档案不得删除。</li>
</ul>
</li>
<li>复查计划入口上传：每个复查项目至少上传 1 张图片后才可提交。</li>
</ul>
<h3 id="43-图片档案归档管理">4.3 图片档案归档管理 </h3>
<ul>
<li>图片档案以“上传日期”为主索引。</li>
<li>医生在工作台可对单张或批量图片进行归档：
<ul>
<li>指定记录类型（一级类目）+ 报告日期。</li>
<li>复查类型需选择二级类目。</li>
</ul>
</li>
<li>当诊疗记录被删除时：
<ul>
<li>图片档案的归档状态需同步更新为未归档或解除关联。</li>
<li>图片本身不应被删除。</li>
</ul>
</li>
</ul>
<h2 id="5-展示与索引规则">5. 展示与索引规则 </h2>
<h3 id="51-诊疗记录列表">5.1 诊疗记录列表 </h3>
<ul>
<li>与患者主页、指标等并列展示。</li>
<li>以“记录类型 + 报告日期”为主索引，列表支持按日期排序。</li>
<li>支持筛选：记录类型、报告日期区间、归档日期区间、归档人。</li>
<li>时间轴按月展示每个月的门诊、复查、住院次数。</li>
<li>点击月份后，下方逐条列出该月事件及日期。</li>
<li>时间轴起止月份：
<ul>
<li>起始：服务包购买日期所在月份。</li>
<li>结束：服务包到期日期所在月份。</li>
</ul>
</li>
<li>展开详情后可查看图片缩略图、图片类目、上传人以及报告备注/解读。</li>
<li>支持“编辑/保存”与“删除此条档案”；删除仅影响归档关系，不删除原始图片。</li>
</ul>
<h3 id="52-图片档案列表">5.2 图片档案列表 </h3>
<ul>
<li>按上传日期排序，突出“未分类/未归档”状态。</li>
<li>支持医生端批量归档操作。</li>
<li>每个上传批次展示：上传时间、上传人、上传入口（个人中心/复查计划）。</li>
<li>归档编辑时可为每张图片单独设置一级类目、二级类目（复查时）、报告日期。</li>
<li>个人中心上传默认未归档；复查计划入口默认归类为“复查”，允许医生调整。</li>
<li>报告日期暂由人工选择，后续可引入 AI 识别（来自配图说明）。</li>
</ul>
<h3 id="53-患者端上传页面">5.3 患者端上传页面 </h3>
<ul>
<li>复查上报页展示“本次复查日期 + 复查项目列表”，按项目上传图片。</li>
<li>个人中心上传报告页：填写报告日期并上传多张图片；列表按日期分组展示。</li>
</ul>
<h2 id="6-流程图mermaid">6. 流程图（Mermaid） </h2>
<h3 id="61-患者上传---图片档案---诊疗记录">6.1 患者上传 -&gt; 图片档案 -&gt; 诊疗记录 </h3>
<div class="mermaid" data-processed="true"><div id="dmermaid-1768561889619" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif;"><svg id="mermaid-1768561889619" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 2412 512" style="max-width: 512px;" role="graphics-document document" aria-roledescription="error"><style>#mermaid-1768561889619{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-1768561889619 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-1768561889619 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-1768561889619 .error-icon{fill:#552222;}#mermaid-1768561889619 .error-text{fill:#552222;stroke:#552222;}#mermaid-1768561889619 .edge-thickness-normal{stroke-width:1px;}#mermaid-1768561889619 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1768561889619 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1768561889619 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-1768561889619 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1768561889619 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1768561889619 .marker{fill:#333333;stroke:#333333;}#mermaid-1768561889619 .marker.cross{stroke:#333333;}#mermaid-1768561889619 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-1768561889619 p{margin:0;}#mermaid-1768561889619 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g></g><g><path class="error-icon" d="m411.313,123.313c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32-9.375,9.375-20.688-20.688c-12.484-12.5-32.766-12.5-45.25,0l-16,16c-1.261,1.261-2.304,2.648-3.31,4.051-21.739-8.561-45.324-13.426-70.065-13.426-105.867,0-192,86.133-192,192s86.133,192 192,192 192-86.133 192-192c0-24.741-4.864-48.327-13.426-70.065 1.402-1.007 2.79-2.049 4.051-3.31l16-16c12.5-12.492 12.5-32.758 0-45.25l-20.688-20.688 9.375-9.375 32.001-31.999zm-219.313,100.687c-52.938,0-96,43.063-96,96 0,8.836-7.164,16-16,16s-16-7.164-16-16c0-70.578 57.422-128 128-128 8.836,0 16,7.164 16,16s-7.164,16-16,16z"></path><path class="error-icon" d="m459.02,148.98c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l16,16c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16.001-16z"></path><path class="error-icon" d="m340.395,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16-16c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l15.999,16z"></path><path class="error-icon" d="m400,64c8.844,0 16-7.164 16-16v-32c0-8.836-7.156-16-16-16-8.844,0-16,7.164-16,16v32c0,8.836 7.156,16 16,16z"></path><path class="error-icon" d="m496,96.586h-32c-8.844,0-16,7.164-16,16 0,8.836 7.156,16 16,16h32c8.844,0 16-7.164 16-16 0-8.836-7.156-16-16-16z"></path><path class="error-icon" d="m436.98,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688l32-32c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32c-6.251,6.25-6.251,16.375-0.001,22.625z"></path><text class="error-text" x="1440" y="250" font-size="150px" style="text-anchor: middle;">Syntax error in text</text><text class="error-text" x="1250" y="400" font-size="100px" style="text-anchor: middle;">mermaid version 11.12.1</text></g></svg></div></div><h3 id="62-医生新增诊疗记录">6.2 医生新增诊疗记录 </h3>
<div class="mermaid" data-processed="true"><svg id="mermaid-1768561889634" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="flowchart" style="max-width: 442px;" viewBox="0 0 442 510" role="graphics-document document" aria-roledescription="flowchart-v2"><style>#mermaid-1768561889634{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-1768561889634 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-1768561889634 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-1768561889634 .error-icon{fill:#552222;}#mermaid-1768561889634 .error-text{fill:#552222;stroke:#552222;}#mermaid-1768561889634 .edge-thickness-normal{stroke-width:1px;}#mermaid-1768561889634 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1768561889634 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1768561889634 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-1768561889634 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1768561889634 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1768561889634 .marker{fill:#333333;stroke:#333333;}#mermaid-1768561889634 .marker.cross{stroke:#333333;}#mermaid-1768561889634 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-1768561889634 p{margin:0;}#mermaid-1768561889634 .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-1768561889634 .cluster-label text{fill:#333;}#mermaid-1768561889634 .cluster-label span{color:#333;}#mermaid-1768561889634 .cluster-label span p{background-color:transparent;}#mermaid-1768561889634 .label text,#mermaid-1768561889634 span{fill:#333;color:#333;}#mermaid-1768561889634 .node rect,#mermaid-1768561889634 .node circle,#mermaid-1768561889634 .node ellipse,#mermaid-1768561889634 .node polygon,#mermaid-1768561889634 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-1768561889634 .rough-node .label text,#mermaid-1768561889634 .node .label text,#mermaid-1768561889634 .image-shape .label,#mermaid-1768561889634 .icon-shape .label{text-anchor:middle;}#mermaid-1768561889634 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-1768561889634 .rough-node .label,#mermaid-1768561889634 .node .label,#mermaid-1768561889634 .image-shape .label,#mermaid-1768561889634 .icon-shape .label{text-align:center;}#mermaid-1768561889634 .node.clickable{cursor:pointer;}#mermaid-1768561889634 .root .anchor path{fill:#333333!important;stroke-width:0;stroke:#333333;}#mermaid-1768561889634 .arrowheadPath{fill:#333333;}#mermaid-1768561889634 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-1768561889634 .flowchart-link{stroke:#333333;fill:none;}#mermaid-1768561889634 .edgeLabel{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaid-1768561889634 .edgeLabel p{background-color:rgba(232,232,232, 0.8);}#mermaid-1768561889634 .edgeLabel rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaid-1768561889634 .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#mermaid-1768561889634 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-1768561889634 .cluster text{fill:#333;}#mermaid-1768561889634 .cluster span{color:#333;}#mermaid-1768561889634 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-1768561889634 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#mermaid-1768561889634 rect.text{fill:none;stroke-width:0;}#mermaid-1768561889634 .icon-shape,#mermaid-1768561889634 .image-shape{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaid-1768561889634 .icon-shape p,#mermaid-1768561889634 .image-shape p{background-color:rgba(232,232,232, 0.8);padding:2px;}#mermaid-1768561889634 .icon-shape rect,#mermaid-1768561889634 .image-shape rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaid-1768561889634 .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-1768561889634 .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-1768561889634 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><marker id="mermaid-1768561889634_flowchart-v2-pointEnd" class="marker flowchart-v2" viewBox="0 0 10 10" refX="5" refY="5" markerUnits="userSpaceOnUse" markerWidth="8" markerHeight="8" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-1768561889634_flowchart-v2-pointStart" class="marker flowchart-v2" viewBox="0 0 10 10" refX="4.5" refY="5" markerUnits="userSpaceOnUse" markerWidth="8" markerHeight="8" orient="auto"><path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-1768561889634_flowchart-v2-circleEnd" class="marker flowchart-v2" viewBox="0 0 10 10" refX="11" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="mermaid-1768561889634_flowchart-v2-circleStart" class="marker flowchart-v2" viewBox="0 0 10 10" refX="-1" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="mermaid-1768561889634_flowchart-v2-crossEnd" class="marker cross flowchart-v2" viewBox="0 0 11 11" refX="12" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-1768561889634_flowchart-v2-crossStart" class="marker cross flowchart-v2" viewBox="0 0 11 11" refX="-1" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"><path d="M205,62L205,66.167C205,70.333,205,78.667,205,86.333C205,94,205,101,205,104.5L205,108" id="L_A_B_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_A_B_0" data-points="W3sieCI6MjA1LCJ5Ijo2Mn0seyJ4IjoyMDUsInkiOjg3fSx7IngiOjIwNSwieSI6MTEyfV0=" marker-end="url(#mermaid-1768561889634_flowchart-v2-pointEnd)"></path><path d="M205,190L205,194.167C205,198.333,205,206.667,205,214.333C205,222,205,229,205,232.5L205,236" id="L_B_C_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_B_C_0" data-points="W3sieCI6MjA1LCJ5IjoxOTB9LHsieCI6MjA1LCJ5IjoyMTV9LHsieCI6MjA1LCJ5IjoyNDB9XQ==" marker-end="url(#mermaid-1768561889634_flowchart-v2-pointEnd)"></path><path d="M205,294L205,298.167C205,302.333,205,310.667,205,318.333C205,326,205,333,205,336.5L205,340" id="L_C_D_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_C_D_0" data-points="W3sieCI6MjA1LCJ5IjoyOTR9LHsieCI6MjA1LCJ5IjozMTl9LHsieCI6MjA1LCJ5IjozNDR9XQ==" marker-end="url(#mermaid-1768561889634_flowchart-v2-pointEnd)"></path><path d="M159,391.101L146.833,396.417C134.667,401.734,110.333,412.367,98.167,421.183C86,430,86,437,86,440.5L86,444" id="L_D_E_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_D_E_0" data-points="W3sieCI6MTU5LCJ5IjozOTEuMTAwODQwMzM2MTM0NDd9LHsieCI6ODYsInkiOjQyM30seyJ4Ijo4NiwieSI6NDQ4fV0=" marker-end="url(#mermaid-1768561889634_flowchart-v2-pointEnd)"></path><path d="M251,391.101L263.167,396.417C275.333,401.734,299.667,412.367,311.833,421.183C324,430,324,437,324,440.5L324,444" id="L_D_F_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_D_F_0" data-points="W3sieCI6MjUxLCJ5IjozOTEuMTAwODQwMzM2MTM0NDd9LHsieCI6MzI0LCJ5Ijo0MjN9LHsieCI6MzI0LCJ5Ijo0NDh9XQ==" marker-end="url(#mermaid-1768561889634_flowchart-v2-pointEnd)"></path></g><g class="edgeLabels"><g class="edgeLabel"><g class="label" data-id="L_A_B_0" transform="translate(0, 0)"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignobject></g></g><g class="edgeLabel"><g class="label" data-id="L_B_C_0" transform="translate(0, 0)"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignobject></g></g><g class="edgeLabel"><g class="label" data-id="L_C_D_0" transform="translate(0, 0)"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignobject></g></g><g class="edgeLabel"><g class="label" data-id="L_D_E_0" transform="translate(0, 0)"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignobject></g></g><g class="edgeLabel"><g class="label" data-id="L_D_F_0" transform="translate(0, 0)"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignobject></g></g></g><g class="nodes"><g class="node default" id="flowchart-A-0" transform="translate(205, 35)"><rect class="basic label-container" style="" x="-94" y="-27" width="188" height="54"></rect><g class="label" style="" transform="translate(-64, -12)"><rect></rect><foreignobject width="128" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>医生新增诊疗记录</p></span></div></foreignobject></g></g><g class="node default" id="flowchart-B-1" transform="translate(205, 151)"><rect class="basic label-container" style="" x="-130" y="-39" width="260" height="78"></rect><g class="label" style="" transform="translate(-100, -24)"><rect></rect><foreignobject width="200" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;"><span class="nodeLabel"><p>填写记录类型/报告日期/医院/备注</p></span></div></foreignobject></g></g><g class="node default" id="flowchart-C-3" transform="translate(205, 267)"><rect class="basic label-container" style="" x="-118" y="-27" width="236" height="54"></rect><g class="label" style="" transform="translate(-88, -12)"><rect></rect><foreignobject width="176" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>上传图片并逐张选择类目</p></span></div></foreignobject></g></g><g class="node default" id="flowchart-D-5" transform="translate(205, 371)"><rect class="basic label-container" style="" x="-46" y="-27" width="92" height="54"></rect><g class="label" style="" transform="translate(-16, -12)"><rect></rect><foreignobject width="32" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>保存</p></span></div></foreignobject></g></g><g class="node default" id="flowchart-E-7" transform="translate(86, 475)"><rect class="basic label-container" style="" x="-78" y="-27" width="156" height="54"></rect><g class="label" style="" transform="translate(-48, -12)"><rect></rect><foreignobject width="96" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>创建诊疗记录</p></span></div></foreignobject></g></g><g class="node default" id="flowchart-F-9" transform="translate(324, 475)"><rect class="basic label-container" style="" x="-110" y="-27" width="220" height="54"></rect><g class="label" style="" transform="translate(-80, -12)"><rect></rect><foreignobject width="160" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>图片档案归档为已归档</p></span></div></foreignobject></g></g></g></g></g></svg></div><h2 id="7-与系统其它模块的关系">7. 与系统其它模块的关系 </h2>
<h3 id="71-health_data-模块">7.1 health_data 模块 </h3>
<ul>
<li><code>health_data.models.ClinicalEvent</code> 对应诊疗记录主体：
<ul>
<li>event_date 对应记录日期，event_type 对应门诊/住院/复查。</li>
<li>files_json 可承载诊疗记录的图片附件集合。</li>
</ul>
</li>
<li><code>health_data.models.TestReport</code> 对应图片报告档案：
<ul>
<li>report_date 对应报告日期，created_at 对应上传日期。</li>
<li>report_type 对应报告类型/类目，image_urls 为图片集合。</li>
<li>interpretation 可承载报告解读结果（医生侧解读流程）。</li>
</ul>
</li>
<li>归档日期与“归档状态”是诊疗记录与图片档案联动的关键字段，需在健康档案域内可追溯。</li>
</ul>
<h3 id="72-core-模块">7.2 core 模块 </h3>
<ul>
<li>复查计划与任务由 core 生成：
<ul>
<li><code>core.models.CheckupLibrary.related_report_type</code> 与 <code>core.models.choices.ReportType</code> 用于绑定报告类型。</li>
<li><code>core.models.DailyTask.related_report_type</code> 支持“上传报告自动完成复查任务”的闭环逻辑。</li>
</ul>
</li>
<li>患者从复查任务入口上传报告时，应继承任务的报告类型并触发自动核销。</li>
<li>诊疗记录与图片归档的类别体系需与 core 的报告类型枚举保持一致或建立映射。</li>
</ul>
<h3 id="73-users-模块">7.3 users 模块 </h3>
<ul>
<li>诊疗记录与图片档案均挂载于 <code>users.PatientProfile</code>。</li>
<li>记录创建者关联 <code>users.DoctorProfile</code>，用于审计与权限控制。</li>
<li><code>PatientRelation</code> 支持家属代管账号访问患者档案。</li>
<li>服务包有效期（会员状态）影响诊疗记录时间轴的起止月份。</li>
</ul>
<h2 id="8-与现有代码对接当前实现位置">8. 与现有代码对接（当前实现位置） </h2>
<h3 id="81-医生端诊疗记录图片档案">8.1 医生端（诊疗记录/图片档案） </h3>
<ul>
<li>页面与交互模板：
<ul>
<li><code>templates/web_doctor/partials/reports_history/list.html</code></li>
<li><code>templates/web_doctor/partials/reports_history/consultation_records.html</code></li>
<li><code>templates/web_doctor/partials/reports_history/image_archives.html</code></li>
<li>新增记录弹窗：<code>templates/web_doctor/partials/home/checkup_record_modal.html</code></li>
</ul>
</li>
<li>数据与接口（当前为模拟数据）：
<ul>
<li><code>web_doctor/views/reports_history_data.py</code> 提供 mock 数据与更新接口。</li>
<li><code>web_doctor/views/reports_history_data.py:patient_report_update</code>、<code>web_doctor/views/reports_history_data.py:batch_archive_images</code></li>
<li>需要替换为真实 DB 读写，并补齐删除/筛选逻辑。</li>
</ul>
</li>
</ul>
<h3 id="82-患者端上传入口">8.2 患者端（上传入口） </h3>
<ul>
<li>个人中心上传报告：
<ul>
<li>列表/上传：<code>web_patient/views/my_report.py</code></li>
<li>页面模板：<code>templates/web_patient/my_report_list.html</code>、<code>templates/web_patient/my_report_upload.html</code></li>
<li>个人中心列表按 <code>created_at</code>（上传日期）分组；<code>report_date</code> 仅在归档/分类时补齐。</li>
</ul>
</li>
<li>复查计划入口上传：
<ul>
<li>页面与模拟数据：<code>web_patient/views/record.py:record_checkup</code></li>
<li>页面模板：<code>templates/web_patient/record_checkup.html</code></li>
<li>需要对接 <code>core</code> 的复查任务与检查项目，并在提交后写入报告数据。</li>
</ul>
</li>
</ul>
<h3 id="83-任务闭环与枚举">8.3 任务闭环与枚举 </h3>
<ul>
<li><code>core/service/tasks.complete_daily_checkup_tasks</code> 可用于“复查上传 -&gt; 任务完成”。</li>
<li><code>core/models.DailyTask.related_report_type</code> 与 <code>core/models.CheckupLibrary.related_report_type</code> 用于报告类型匹配。</li>
<li>复查报告分类依赖 <code>core.CheckupLibrary</code>；<code>ReportType</code> 仅用于任务核销，允许只覆盖常用项目。</li>
</ul>
<h2 id="9-数据表归属建议如需新建扩展">9. 数据表归属建议（如需新建/扩展） </h2>
<ul>
<li>建议归入 <code>health_data</code> app（属于健康档案域），避免放在 <code>core</code>（任务调度）或 <code>users</code>（账号域）。</li>
<li>可能需要补齐以下数据结构（用于支撑图片级归档与上传来源）：
<ul>
<li>上传批次/记录：记录上传时间、上传入口（个人中心/复查计划/医生端）、上传人、关联任务。</li>
<li>图片明细：每张图片的 URL、一级/二级类目、报告日期、归档状态、归档人/归档时间。</li>
<li>诊疗记录：可继续用 <code>ClinicalEvent</code> 并扩展备注/解读、归档信息；或新增“诊疗记录”表承载分组与解读。</li>
</ul>
</li>
</ul>
<h2 id="10-表结构草案建议">10. 表结构草案（建议） </h2>
<h3 id="101-实体与作用">10.1 实体与作用 </h3>
<ul>
<li>ReportUpload（建议重构原 <code>TestReport</code>）：一次上传动作的批次记录，用于“图片档案”按上传日期分组展示。</li>
<li>ReportImage（新增）：图片明细表，承载单张图片的类目、报告日期与归档状态。</li>
<li>ClinicalEvent（扩展）：诊疗记录的聚合载体，承载记录类型/报告日期/备注解读等信息。</li>
<li>CheckupLibrary（既有）：复查项目标准库，作为复查二级类目的权威来源。</li>
</ul>
<h3 id="102-核心字段建议带注释">10.2 核心字段建议（带注释） </h3>
<ul>
<li>
<p>ReportUpload（health_data.ReportUpload）</p>
<ul>
<li>patient_id：所属患者（<code>users.PatientProfile</code>）。</li>
<li>upload_source：上传入口（个人中心/复查计划/医生端）。</li>
<li>uploader_id + uploader_role：上传人（患者/医生/助理）。</li>
<li>related_task_id：关联的复查任务（<code>core.DailyTask</code>，可空）。</li>
<li>created_at：上传时间（用于列表分组）。</li>
<li>deleted_at：患者删除上传记录时标记；已归档的图片不删除。</li>
<li>迁移说明：<code>image_urls</code> 下沉到 ReportImage；<code>report_type</code>/<code>interpretation</code> 分别由 ReportImage/ClinicalEvent 承载。</li>
</ul>
</li>
<li>
<p>ReportImage（health_data.ReportImage）</p>
<ul>
<li>upload_id：所属上传批次（<code>ReportUpload</code>）。</li>
<li>image_url：图片地址。</li>
<li>record_type：门诊/住院/复查（一级类目）。</li>
<li>checkup_item_id：复查二级类目（<code>core.CheckupLibrary</code>，仅复查时有值；“其他”也走该表）。</li>
<li>report_date：报告日期（归档时填写；未归档可为空）。</li>
<li>clinical_event_id：归档后的诊疗记录（<code>ClinicalEvent</code>，可空）。</li>
<li>archived_by/archived_at：归档人/归档时间。</li>
<li>ocr_text：可选，识别文本。</li>
</ul>
</li>
<li>
<p>ClinicalEvent（health_data.ClinicalEvent 扩展）</p>
<ul>
<li>event_type/event_date：记录类型与报告日期。</li>
<li>hospital_name/department_name：就诊信息（医生端可选）。</li>
<li>interpretation：报告备注与解读（替代 description）。</li>
<li>created_by_doctor/created_at：用于归档人/归档日期展示。</li>
</ul>
</li>
</ul>
<h3 id="103-实体关系图mermaid">10.3 实体关系图（Mermaid） </h3>
<div class="mermaid" data-processed="true"><svg id="mermaid-1768561889693" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="erDiagram" style="max-width: 1417.44677734375px;" viewBox="0.00000762939453125 0 1417.44677734375 470" role="graphics-document document" aria-roledescription="er"><style>#mermaid-1768561889693{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-1768561889693 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-1768561889693 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-1768561889693 .error-icon{fill:#552222;}#mermaid-1768561889693 .error-text{fill:#552222;stroke:#552222;}#mermaid-1768561889693 .edge-thickness-normal{stroke-width:1px;}#mermaid-1768561889693 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1768561889693 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1768561889693 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-1768561889693 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1768561889693 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1768561889693 .marker{fill:#333333;stroke:#333333;}#mermaid-1768561889693 .marker.cross{stroke:#333333;}#mermaid-1768561889693 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-1768561889693 p{margin:0;}#mermaid-1768561889693 .entityBox{fill:#ECECFF;stroke:#9370DB;}#mermaid-1768561889693 .relationshipLabelBox{fill:hsl(80, 100%, 96.2745098039%);opacity:0.7;background-color:hsl(80, 100%, 96.2745098039%);}#mermaid-1768561889693 .relationshipLabelBox rect{opacity:0.5;}#mermaid-1768561889693 .labelBkg{background-color:rgba(248.6666666666, 255, 235.9999999999, 0.5);}#mermaid-1768561889693 .edgeLabel .label{fill:#9370DB;font-size:14px;}#mermaid-1768561889693 .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-1768561889693 .edge-pattern-dashed{stroke-dasharray:8,8;}#mermaid-1768561889693 .node rect,#mermaid-1768561889693 .node circle,#mermaid-1768561889693 .node ellipse,#mermaid-1768561889693 .node polygon{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-1768561889693 .relationshipLine{stroke:#333333;stroke-width:1;fill:none;}#mermaid-1768561889693 .marker{fill:none!important;stroke:#333333!important;stroke-width:1;}#mermaid-1768561889693 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><defs><marker id="mermaid-1768561889693_er-onlyOneStart" class="marker onlyOne er" refX="0" refY="9" markerWidth="18" markerHeight="18" orient="auto"><path d="M9,0 L9,18 M15,0 L15,18"></path></marker></defs><defs><marker id="mermaid-1768561889693_er-onlyOneEnd" class="marker onlyOne er" refX="18" refY="9" markerWidth="18" markerHeight="18" orient="auto"><path d="M3,0 L3,18 M9,0 L9,18"></path></marker></defs><defs><marker id="mermaid-1768561889693_er-zeroOrOneStart" class="marker zeroOrOne er" refX="0" refY="9" markerWidth="30" markerHeight="18" orient="auto"><circle fill="white" cx="21" cy="9" r="6"></circle><path d="M9,0 L9,18"></path></marker></defs><defs><marker id="mermaid-1768561889693_er-zeroOrOneEnd" class="marker zeroOrOne er" refX="30" refY="9" markerWidth="30" markerHeight="18" orient="auto"><circle fill="white" cx="9" cy="9" r="6"></circle><path d="M21,0 L21,18"></path></marker></defs><defs><marker id="mermaid-1768561889693_er-oneOrMoreStart" class="marker oneOrMore er" refX="18" refY="18" markerWidth="45" markerHeight="36" orient="auto"><path d="M0,18 Q 18,0 36,18 Q 18,36 0,18 M42,9 L42,27"></path></marker></defs><defs><marker id="mermaid-1768561889693_er-oneOrMoreEnd" class="marker oneOrMore er" refX="27" refY="18" markerWidth="45" markerHeight="36" orient="auto"><path d="M3,9 L3,27 M9,18 Q27,0 45,18 Q27,36 9,18"></path></marker></defs><defs><marker id="mermaid-1768561889693_er-zeroOrMoreStart" class="marker zeroOrMore er" refX="18" refY="18" markerWidth="57" markerHeight="36" orient="auto"><circle fill="white" cx="48" cy="18" r="6"></circle><path d="M0,18 Q18,0 36,18 Q18,36 0,18"></path></marker></defs><defs><marker id="mermaid-1768561889693_er-zeroOrMoreEnd" class="marker zeroOrMore er" refX="39" refY="18" markerWidth="57" markerHeight="36" orient="auto"><circle fill="white" cx="9" cy="18" r="6"></circle><path d="M21,18 Q39,0 57,18 Q39,36 21,18"></path></marker></defs><g class="root"><g class="clusters"></g><g class="edgePaths"><path d="M115.903,92L115.903,100.417C115.903,108.833,115.903,125.667,147.984,143.822C180.066,161.978,244.228,181.455,276.309,191.194L308.391,200.933" id="id_entity-USERS_PATIENT_PROFILE-0_entity-HEALTH_REPORT_UPLOAD-1_0" class="edge-thickness-normal edge-pattern-solid relationshipLine" style="undefined;;;undefined" data-edge="true" data-et="edge" data-id="id_entity-USERS_PATIENT_PROFILE-0_entity-HEALTH_REPORT_UPLOAD-1_0" data-points="W3sieCI6MTE1LjkwMzEyMTk0ODI0MjE5LCJ5Ijo5Mn0seyJ4IjoxMTUuOTAzMTIxOTQ4MjQyMTksInkiOjE0Mi41fSx7IngiOjMwOC4zOTA2MjUsInkiOjIwMC45MzI3MzY4Njk4MDAwN31d" marker-start="url(#mermaid-1768561889693_er-onlyOneStart)" marker-end="url(#mermaid-1768561889693_er-zeroOrMoreEnd)"></path><path d="M456.892,92L456.892,100.417C456.892,108.833,456.892,125.667,453.591,142.5C450.29,159.333,443.688,176.167,440.387,184.583L437.086,193" id="id_entity-USERS_CUSTOMUSER-2_entity-HEALTH_REPORT_UPLOAD-1_1" class="edge-thickness-normal edge-pattern-solid relationshipLine" style="undefined;;;undefined" data-edge="true" data-et="edge" data-id="id_entity-USERS_CUSTOMUSER-2_entity-HEALTH_REPORT_UPLOAD-1_1" data-points="W3sieCI6NDU2Ljg5MjE4MTM5NjQ4NDQsInkiOjkyfSx7IngiOjQ1Ni44OTIxODEzOTY0ODQ0LCJ5IjoxNDIuNX0seyJ4Ijo0MzcuMDg2Mjg3NzkyMzA4OSwieSI6MTkzfV0=" marker-start="url(#mermaid-1768561889693_er-onlyOneStart)" marker-end="url(#mermaid-1768561889693_er-zeroOrMoreEnd)"></path><path d="M773.955,92L773.955,100.417C773.955,108.833,773.955,125.667,733.768,144.604C693.582,163.54,613.21,184.581,573.024,195.101L532.837,205.621" id="id_entity-CORE_DAILY_TASK-3_entity-HEALTH_REPORT_UPLOAD-1_2" class="edge-thickness-normal edge-pattern-solid relationshipLine" style="undefined;;;undefined" data-edge="true" data-et="edge" data-id="id_entity-CORE_DAILY_TASK-3_entity-HEALTH_REPORT_UPLOAD-1_2" data-points="W3sieCI6NzczLjk1NDY4MTM5NjQ4NDQsInkiOjkyfSx7IngiOjc3My45NTQ2ODEzOTY0ODQ0LCJ5IjoxNDIuNX0seyJ4Ijo1MzIuODM3NDkzODk2NDg0NCwieSI6MjA1LjYyMTM1Nzg1Nzk2MjR9XQ==" marker-start="url(#mermaid-1768561889693_er-onlyOneStart)" marker-end="url(#mermaid-1768561889693_er-zeroOrMoreEnd)"></path><path d="M420.614,277L420.614,285.417C420.614,293.833,420.614,310.667,499.387,331.68C578.161,352.693,735.708,377.885,814.481,390.482L893.255,403.078" id="id_entity-HEALTH_REPORT_UPLOAD-1_entity-HEALTH_REPORT_IMAGE-4_3" class="edge-thickness-normal edge-pattern-solid relationshipLine" style="undefined;;;undefined" data-edge="true" data-et="edge" data-id="id_entity-HEALTH_REPORT_UPLOAD-1_entity-HEALTH_REPORT_IMAGE-4_3" data-points="W3sieCI6NDIwLjYxNDA1OTQ0ODI0MjIsInkiOjI3N30seyJ4Ijo0MjAuNjE0MDU5NDQ4MjQyMiwieSI6MzI3LjV9LHsieCI6ODkzLjI1NDY3NjgxODg0NzcsInkiOjQwMy4wNzc5NzA0NTI1MDY3fV0=" marker-start="url(#mermaid-1768561889693_er-onlyOneStart)" marker-end="url(#mermaid-1768561889693_er-zeroOrMoreEnd)"></path><path d="M782.577,277L782.577,285.417C782.577,293.833,782.577,310.667,802.276,327.5C821.976,344.333,861.376,361.167,881.076,369.583L900.776,378" id="id_entity-CORE_CHECKUP_LIBRARY-5_entity-HEALTH_REPORT_IMAGE-4_4" class="edge-thickness-normal edge-pattern-solid relationshipLine" style="undefined;;;undefined" data-edge="true" data-et="edge" data-id="id_entity-CORE_CHECKUP_LIBRARY-5_entity-HEALTH_REPORT_IMAGE-4_4" data-points="W3sieCI6NzgyLjU3NjU1MzM0NDcyNjYsInkiOjI3N30seyJ4Ijo3ODIuNTc2NTUzMzQ0NzI2NiwieSI6MzI3LjV9LHsieCI6OTAwLjc3NTU1NDIyMzk2MjcsInkiOjM3OH1d" marker-start="url(#mermaid-1768561889693_er-onlyOneStart)" marker-end="url(#mermaid-1768561889693_er-zeroOrMoreEnd)"></path><path d="M1143.027,277L1143.027,285.417C1143.027,293.833,1143.027,310.667,1129.929,327.5C1116.831,344.333,1090.635,361.167,1077.537,369.583L1064.439,378" id="id_entity-HEALTH_CLINICAL_EVENT-6_entity-HEALTH_REPORT_IMAGE-4_5" class="edge-thickness-normal edge-pattern-solid relationshipLine" style="undefined;;;undefined" data-edge="true" data-et="edge" data-id="id_entity-HEALTH_CLINICAL_EVENT-6_entity-HEALTH_REPORT_IMAGE-4_5" data-points="W3sieCI6MTE0My4wMjY1NTAyOTI5Njg4LCJ5IjoyNzd9LHsieCI6MTE0My4wMjY1NTAyOTI5Njg4LCJ5IjozMjcuNX0seyJ4IjoxMDY0LjQzOTMzNjYyMjA4MzYsInkiOjM3OH1d" marker-start="url(#mermaid-1768561889693_er-onlyOneStart)" marker-end="url(#mermaid-1768561889693_er-zeroOrMoreEnd)"></path><path d="M1329.006,92L1336.104,100.417C1343.201,108.833,1357.397,125.667,1364.494,149.5C1371.592,173.333,1371.592,204.167,1371.592,235C1371.592,265.833,1371.592,296.667,1327.144,323.12C1282.696,349.574,1193.801,371.648,1149.353,382.685L1104.905,393.722" id="id_entity-USERS_DOCTOR_PROFILE-7_entity-HEALTH_REPORT_IMAGE-4_6" class="edge-thickness-normal edge-pattern-solid relationshipLine" style="undefined;;;undefined" data-edge="true" data-et="edge" data-id="id_entity-USERS_DOCTOR_PROFILE-7_entity-HEALTH_REPORT_IMAGE-4_6" data-points="W3sieCI6MTMyOS4wMDU4MzAxNjY3OTEsInkiOjkyfSx7IngiOjEzNzEuNTkyMTc0NTMwMDI5MywieSI6MTQyLjV9LHsieCI6MTM3MS41OTIxNzQ1MzAwMjkzLCJ5IjoyMzV9LHsieCI6MTM3MS41OTIxNzQ1MzAwMjkzLCJ5IjozMjcuNX0seyJ4IjoxMTA0LjkwNDY3MDcxNTMzMiwieSI6MzkzLjcyMjE5MTM0MjEzMjF9XQ==" marker-start="url(#mermaid-1768561889693_er-onlyOneStart)" marker-end="url(#mermaid-1768561889693_er-zeroOrMoreEnd)"></path><path d="M1225.225,92L1211.525,100.417C1197.825,108.833,1170.426,125.667,1156.726,142.5C1143.027,159.333,1143.027,176.167,1143.027,184.583L1143.027,193" id="id_entity-USERS_DOCTOR_PROFILE-7_entity-HEALTH_CLINICAL_EVENT-6_7" class="edge-thickness-normal edge-pattern-solid relationshipLine" style="undefined;;;undefined" data-edge="true" data-et="edge" data-id="id_entity-USERS_DOCTOR_PROFILE-7_entity-HEALTH_CLINICAL_EVENT-6_7" data-points="W3sieCI6MTIyNS4yMjQ2ODE4NjQ1NTgsInkiOjkyfSx7IngiOjExNDMuMDI2NTUwMjkyOTY4OCwieSI6MTQyLjV9LHsieCI6MTE0My4wMjY1NTAyOTI5Njg4LCJ5IjoxOTN9XQ==" marker-start="url(#mermaid-1768561889693_er-onlyOneStart)" marker-end="url(#mermaid-1768561889693_er-zeroOrMoreEnd)"></path></g><g class="edgeLabels"><g class="edgeLabel" transform="translate(115.90312194824219, 142.5)"><g class="label" data-id="id_entity-USERS_PATIENT_PROFILE-0_entity-HEALTH_REPORT_UPLOAD-1_0" transform="translate(-23.957813262939453, -10.5)"><foreignobject width="47.915626525878906" height="21"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"><p>uploads</p></span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(456.8921813964844, 142.5)"><g class="label" data-id="id_entity-USERS_CUSTOMUSER-2_entity-HEALTH_REPORT_UPLOAD-1_1" transform="translate(-35.19843673706055, -10.5)"><foreignobject width="70.3968734741211" height="21"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"><p>created_by</p></span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(773.9546813964844, 142.5)"><g class="label" data-id="id_entity-CORE_DAILY_TASK-3_entity-HEALTH_REPORT_UPLOAD-1_2" transform="translate(-39.26250076293945, -10.5)"><foreignobject width="78.5250015258789" height="21"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"><p>related_task</p></span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(420.6140594482422, 327.5)"><g class="label" data-id="id_entity-HEALTH_REPORT_UPLOAD-1_entity-HEALTH_REPORT_IMAGE-4_3" transform="translate(-26.154687881469727, -10.5)"><foreignobject width="52.30937576293945" height="21"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"><p>contains</p></span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(782.5765533447266, 327.5)"><g class="label" data-id="id_entity-CORE_CHECKUP_LIBRARY-5_entity-HEALTH_REPORT_IMAGE-4_4" transform="translate(-47.78750228881836, -10.5)"><foreignobject width="95.57500457763672" height="21"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"><p>categorized_by</p></span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(1143.0265502929688, 327.5)"><g class="label" data-id="id_entity-HEALTH_CLINICAL_EVENT-6_entity-HEALTH_REPORT_IMAGE-4_5" transform="translate(-42.85468673706055, -10.5)"><foreignobject width="85.7093734741211" height="21"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"><p>archived_into</p></span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(1371.5921745300293, 235)"><g class="label" data-id="id_entity-USERS_DOCTOR_PROFILE-7_entity-HEALTH_REPORT_IMAGE-4_6" transform="translate(-37.85468673706055, -10.5)"><foreignobject width="75.7093734741211" height="21"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"><p>archived_by</p></span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(1143.0265502929688, 142.5)"><g class="label" data-id="id_entity-USERS_DOCTOR_PROFILE-7_entity-HEALTH_CLINICAL_EVENT-6_7" transform="translate(-35.19843673706055, -10.5)"><foreignobject width="70.3968734741211" height="21"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"><p>created_by</p></span></div></foreignobject></g></g></g><g class="nodes"><g class="node default" id="entity-USERS_PATIENT_PROFILE-0" transform="translate(115.90312194824219, 50)"><rect class="basic label-container" style="" x="-107.90312957763672" y="-42" width="215.80625915527344" height="84"></rect><g class="label" style="" transform="translate(-87.90312957763672, -12)"><rect></rect><foreignobject width="175.80625915527344" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>USERS_PATIENT_PROFILE</p></span></div></foreignobject></g></g><g class="node default" id="entity-HEALTH_REPORT_UPLOAD-1" transform="translate(420.6140594482422, 235)"><rect class="basic label-container" style="" x="-112.22344207763672" y="-42" width="224.44688415527344" height="84"></rect><g class="label" style="" transform="translate(-92.22344207763672, -12)"><rect></rect><foreignobject width="184.44688415527344" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>HEALTH_REPORT_UPLOAD</p></span></div></foreignobject></g></g><g class="node default" id="entity-USERS_CUSTOMUSER-2" transform="translate(456.8921813964844, 50)"><rect class="basic label-container" style="" x="-93.0859375" y="-42" width="186.171875" height="84"></rect><g class="label" style="" transform="translate(-73.0859375, -12)"><rect></rect><foreignobject width="146.171875" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>USERS_CUSTOMUSER</p></span></div></foreignobject></g></g><g class="node default" id="entity-CORE_DAILY_TASK-3" transform="translate(773.9546813964844, 50)"><rect class="basic label-container" style="" x="-83.9765625" y="-42" width="167.953125" height="84"></rect><g class="label" style="" transform="translate(-63.9765625, -12)"><rect></rect><foreignobject width="127.953125" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>CORE_DAILY_TASK</p></span></div></foreignobject></g></g><g class="node default" id="entity-HEALTH_REPORT_IMAGE-4" transform="translate(999.0796737670898, 420)"><rect class="basic label-container" style="" x="-105.82500457763672" y="-42" width="211.65000915527344" height="84"></rect><g class="label" style="" transform="translate(-85.82500457763672, -12)"><rect></rect><foreignobject width="171.65000915527344" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>HEALTH_REPORT_IMAGE</p></span></div></foreignobject></g></g><g class="node default" id="entity-CORE_CHECKUP_LIBRARY-5" transform="translate(782.5765533447266, 235)"><rect class="basic label-container" style="" x="-109.73906707763672" y="-42" width="219.47813415527344" height="84"></rect><g class="label" style="" transform="translate(-89.73906707763672, -12)"><rect></rect><foreignobject width="179.47813415527344" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>CORE_CHECKUP_LIBRARY</p></span></div></foreignobject></g></g><g class="node default" id="entity-HEALTH_CLINICAL_EVENT-6" transform="translate(1143.0265502929688, 235)"><rect class="basic label-container" style="" x="-110.7109375" y="-42" width="221.421875" height="84"></rect><g class="label" style="" transform="translate(-90.7109375, -12)"><rect></rect><foreignobject width="181.421875" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>HEALTH_CLINICAL_EVENT</p></span></div></foreignobject></g></g><g class="node default" id="entity-USERS_DOCTOR_PROFILE-7" transform="translate(1293.5874843597412, 50)"><rect class="basic label-container" style="" x="-108.81719207763672" y="-42" width="217.63438415527344" height="84"></rect><g class="label" style="" transform="translate(-88.81719207763672, -12)"><rect></rect><foreignobject width="177.63438415527344" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>USERS_DOCTOR_PROFILE</p></span></div></foreignobject></g></g></g></g></g></svg></div><h3 id="104-复查报告与-checkup-关联规则">10.4 复查报告与 Checkup 关联规则 </h3>
<ul>
<li>ReportImage 在 <code>record_type=复查</code> 时必须关联 <code>checkup_item_id</code>。</li>
<li><code>CheckupLibrary</code> 作为复查二级类目的唯一来源；<code>related_report_type</code> 仅用于任务核销，允许只覆盖常用项目。</li>
<li>“其他”建议在 <code>core.CheckupLibrary</code> 增加一条记录（name=其他, code=OTHER, related_report_type=UNKNOWN）。
<ul>
<li>如需避免进入医生计划配置，可设 <code>is_active=false</code> 或增加 <code>is_selectable</code> 标记做区分。</li>
</ul>
</li>
</ul>
<h2 id="12-服务层方法清单供-view-调用">12. 服务层方法清单（供 View 调用） </h2>
<h3 id="121-reportuploadservicehealth_dataservicesreport_servicepy">12.1 ReportUploadService（health_data/services/report_service.py） </h3>
<ul>
<li>create_upload(patient, images, uploader=None, upload_source=..., uploader_role=None, related_task=None)
<ul>
<li>用途：创建上传批次与图片明细，适用于个人中心/复查计划/医生端上传。</li>
<li>入参：images 为图片列表（支持字符串 URL 或 dict 结构）。</li>
<li>返回：ReportUpload 对象；失败抛 ValidationError。</li>
</ul>
</li>
<li>list_uploads(patient, include_deleted=False, upload_source=None, start_date=None, end_date=None)
<ul>
<li>用途：按上传时间范围与入口过滤上传批次，供列表展示与统计复用。</li>
<li>返回：QuerySet。</li>
</ul>
</li>
<li>delete_upload(upload)
<ul>
<li>用途：患者删除上传记录；若含已归档图片则仅标记 deleted_at，否则删除整批及图片。</li>
<li>返回：bool（是否物理删除）。</li>
</ul>
</li>
</ul>
<h3 id="122-reportarchiveservicehealth_dataservicesreport_servicepy">12.2 ReportArchiveService（health_data/services/report_service.py） </h3>
<ul>
<li>create_clinical_event(patient, event_type, event_date, created_by_doctor=None, hospital_name="", department_name="", interpretation="")
<ul>
<li>用途：创建或补全诊疗记录，用于诊疗记录列表与图片归档绑定。</li>
<li>返回：ClinicalEvent 对象。</li>
</ul>
</li>
<li>update_clinical_event(event, **fields)
<ul>
<li>用途：更新诊疗记录的医院/科室/解读等信息，供编辑功能复用。</li>
<li>返回：ClinicalEvent 对象。</li>
</ul>
</li>
<li>archive_images(archiver, updates)
<ul>
<li>用途：批量归档图片（设置类目/报告日期/归档人），并自动关联或创建 ClinicalEvent。</li>
<li>入参：updates 为图片更新数组，必须包含 image_id、record_type、report_date；复查类型需 checkup_item_id。</li>
<li>返回：更新数量。</li>
</ul>
</li>
<li>create_record_with_images(patient, created_by_doctor, event_type, event_date, images, hospital_name="", department_name="", interpretation="", uploader=None)
<ul>
<li>用途：医生端“新增诊疗记录”一站式创建（上传批次 + 图片 + 诊疗记录）。</li>
<li>返回：ClinicalEvent 对象。</li>
</ul>
</li>
<li>delete_clinical_event(event)
<ul>
<li>用途：删除诊疗记录，同时清理其关联图片的归档信息（回到未归档状态）。</li>
<li>返回：清理的图片数量。</li>
</ul>
</li>
</ul>

      </div>
      
      
    
    
    <script type="module">
// TODO: If ZenUML gets integrated into mermaid in the future,
//      we can remove the following lines.


var MERMAID_CONFIG = ({"startOnLoad":false});
if (typeof MERMAID_CONFIG !== 'undefined') {
  MERMAID_CONFIG.startOnLoad = false
  MERMAID_CONFIG.cloneCssStyles = false
  MERMAID_CONFIG.theme = "default"
}

mermaid.initialize(MERMAID_CONFIG || {})
if (typeof(window['Reveal']) !== 'undefined') {
  function mermaidRevealHelper(event) {
    var currentSlide = event.currentSlide
    var diagrams = currentSlide.querySelectorAll('.mermaid')
    for (var i = 0; i < diagrams.length; i++) {
      var diagram = diagrams[i]
      if (!diagram.hasAttribute('data-processed')) {
        mermaid.init(null, diagram, ()=> {
          Reveal.slide(event.indexh, event.indexv)
        })
      }
    }
  }
  Reveal.addEventListener('slidetransitionend', mermaidRevealHelper)
  Reveal.addEventListener('ready', mermaidRevealHelper)
  await mermaid.run({
    nodes: document.querySelectorAll('.mermaid')
  })
} else {
  await mermaid.run({
    nodes: document.querySelectorAll('.mermaid')
  })
}
</script>
    
    
    
  
    <div class="mermaidTooltip" style="opacity: 0;"></div></body><div id="immersive-translate-browser-popup" style="all: initial"><template shadowrootmode="open"><style>/** 基础色阶定义 **/
:root,
#mount[data-theme="light"],
#mount:not([data-theme="dark"]) {
  /* 中性灰阶（light） */
  --c-00: #000000;
  --c-22: #222222;
  --c-33: #333333;
  --c-66: #666666;
  --c-83: #838383;
  --c-99: #999999;
  --c-c7: #c7c7c7;
  --c-cc: #cccccc;
  --c-e6: #e6e6e6;
  --c-f5: #f5f5f5;
  --c-ff: #ffffff;
  /* 品牌主色阶（light） */
  --p-main: #ea4c89;
  --p-hover: #ec5e95;
  --p-active: #e34a85;
  --p-special: #ee71a2;
  --p-disabled: #f4a5c4;
  --p-text-disabled: #f9c9dc;
  --p-weak: #fdedf3;
  /* Surface 层级（light，TC 填充-1） */
  --s-1: #f3f5f6;
  --s-1-hover: #f6f8f9;
  --s-1-active: #edf1f2;
  --s-1-weak: #fafbfb;
  /* 输入/边框（light，TC 填充-2） */
  --input-bg-base: #fafbfc;
  --input-border: #ecf0f7;
  --input-border-strong: #e0e0e6;
  --input-bg-strong: #fafdff;
}

:root[data-theme="dark"],
[data-theme="dark"] {
  /* 中性灰阶（dark） */
  --c-00: #ffffff;
  --c-22: #dbdbdb;
  --c-33: #dbdbdb;
  --c-66: #b3b3b3;
  --c-83: #838383;
  --c-99: #707070;
  --c-c7: #666666;
  --c-cc: #5c5c5c;
  --c-e6: #3b3b3b;
  --c-f5: #262626;
  --c-ff: #222222;
  /* 品牌主色阶（dark） */
  --p-main: #e23c7c;
  --p-hover: #ea4c89;
  --p-active: #d5467d;
  --p-special: #a93a65;
  --p-disabled: #7e2f4d;
  --p-text-disabled: #522335;
  --p-weak: #26171d;
  /* Surface 层级（dark，TC 填充-1） */
  --s-1: #2d2e2f;
  --s-1-hover: #323434;
  --s-1-active: #202121;
  --s-1-weak: #262627;
  /* 输入/边框（dark，TC 填充-2） */
  --input-bg-base: #2b2d30;
  --input-border: #3e434b;
  --input-border-strong: #43474b;
  --input-bg-strong: #1f2123;
}

:root,
#mount [data-theme] {
  /* 业务/通用变量引用色阶（全局可见，含 Shadow DOM） */
  --primary: var(--p-main);
  --primary-hover: var(--p-hover);
  --primary-inverse: #fff;
  --modal-background: var(--s-1);
  --modal-border: var(--input-border);
  --modal-text: var(--c-22);
  --modal-text-secondary: var(--c-66);
  --modal-error: var(--p-main);
  --modal-required: #f53f3f;
  --modal-success: #68cd52;
  --modal-button-background: var(--p-main);
  --modal-button-text: var(--c-ff);
  --modal-input-background: var(--input-bg-base);
  --modal-check-color: var(--p-main);
  --background-color: var(--c-ff);
  --background-light-green: var(--s-1-weak, #f5f7f9);
  --text-black-2: var(--c-22);
  --text-gray-2: var(--c-22);
  --text-gray-6: var(--c-66);
  --text-gray-9: var(--c-99);
  --text-gray-c2: var(--c-c7);
  --switch-background-color: var(--c-c7, hsl(205deg, 16%, 77%));
  --float-ball-more-button-border-color: var(--c-f5, #f6f6f6);
  --float-ball-more-button-background-color: var(--c-ff);
  --float-ball-more-button-svg-color: #6c6f73;
  --service-bg-hover: var(--s-1-hover, #f7faff);
  --service-bg: var(--s-1-weak, #fafbfb);
}

#mount {
  --font-family: var(
    system-ui,
    -apple-system,
    "Segoe UI",
    "Roboto",
    "Ubuntu",
    "Cantarell",
    "Noto Sans",
    sans-serif,
    "Apple Color Emoji",
    "Segoe UI Emoji",
    "Segoe UI Symbol",
    "Noto Color Emoji"
  );
  /* PC/H5 兼容的字号、间距、圆角、阴影变量 */
  --f-12: 12px;
  --f-14: 14px;
  --f-15: 15px;
  --f-16: 16px;
  --f-18: 18px;
  --f-20: 20px;
  --space-4: 4px;
  --space-6: 6px;
  --space-8: 8px;
  --space-12: 12px;
  --space-16: 16px;
  --space-18: 18px;
  --space-24: 24px;
  --radius-8: 8px;
  --radius-12: 12px;
  --radius-16: 16px;
  --control-height-lg: 44px;
  --width-28: 28px;
  --width-24: 24px;
  --width-20: 20px;
  --width-18: 18px;
  --width-16: 16px;
  --width-label-md: 56px;
  --shadow-lg: 0 18px 48px rgba(0, 0, 0, 0.12);

  /* 常规变量 */
  --line-height: 1.5;
  --font-weight: 400;
  --font-size: 16px;
  --border-radius: 4px;
  --border-width: 2px;
  --outline-width: 3px;
  --spacing: 16px;
  --typography-spacing-vertical: 24px;
  --block-spacing-vertical: calc(var(--spacing) * 2);
  --block-spacing-horizontal: var(--spacing);
  --grid-spacing-vertical: 0;
  --grid-spacing-horizontal: var(--spacing);
  --form-element-spacing-vertical: 12px;
  --form-element-spacing-horizontal: 16px;
  --nav-element-spacing-vertical: 16px;
  --nav-element-spacing-horizontal: 8px;
  --nav-link-spacing-vertical: 8px;
  --nav-link-spacing-horizontal: 8px;
  --form-label-font-weight: var(--font-weight);
  --transition: 0.2s ease-in-out;
  --modal-overlay-backdrop-filter: blur(4px);
  --switch-color: var(--primary-inverse);
  --switch-checked-background-color: var(--primary);
  --icon-xia: url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgaWQ9IkZyYW1lIj4KPHBhdGggaWQ9IlZlY3RvciIgZD0iTTguMDAyOTEgOS42Nzk4M0wzLjgzMzM5IDUuNTEyMjFMMy4wMjUzOSA2LjMxOTgzTDguMDAzMjkgMTEuMjk1MUwxMi45NzYyIDYuMzE5ODNMMTIuMTY3OSA1LjUxMjIxTDguMDAyOTEgOS42Nzk4M1oiIGZpbGw9IiM4MzgzODMiLz4KPC9nPgo8L3N2Zz4K");
  /* 兼容旧变量：主色直接引用品牌主色阶 */
  --primary: var(--p-main);
  --primary-hover: var(--p-hover);
  --primary-inverse: #fff;
  /* Modal 业务变量引用色阶 */
  --modal-background: var(--s-1);
  --modal-border: var(--input-border);
  --modal-text: var(--c-22);
  --modal-text-secondary: var(--c-66);
  --modal-error: var(--p-main);
  --modal-required: #f53f3f;
  --modal-success: #68cd52;
  --modal-button-background: var(--p-main);
  --modal-button-text: var(--c-ff);
  --modal-input-background: var(--input-bg-base);
  --modal-check-color: var(--p-main);
  --background-color: var(--c-ff);
  --background-light-green: var(--s-1-weak, #f5f7f9);
  --text-black-2: var(--c-22);
  --text-gray-2: var(--c-22);
  --text-gray-6: var(--c-66);
  --text-gray-9: var(--c-99);
  --text-gray-c2: var(--c-c7);
  --switch-background-color: var(--c-c7, hsl(205deg, 16%, 77%));
  --float-ball-more-button-border-color: var(--c-f5, #f6f6f6);
  --float-ball-more-button-background-color: var(--c-ff);
  --float-ball-more-button-svg-color: #6c6f73;
  --service-bg-hover: var(--s-1-hover, #f7faff);
  --service-bg: var(--s-1-weak, #fafbfb);
  line-height: var(--line-height);
  font-family: var(--font-family);
  font-size: var(--font-size);
}

@media (max-width: 480px) {
  :root,
  #mount {
    --f-12: 10px;
    --f-14: 12px;
    --f-15: 13px;
    --f-16: 14px;
    --f-18: 16px;
    --f-20: 18px;
    --space-4: 4px;
    --space-6: 4px;
    --space-8: 6px;
    --space-12: 8px;
    --space-16: 12px;
    --space-18: 14px;
    --space-24: 18px;
    --radius-8: 6px;
    --radius-12: 10px;
    --radius-16: 12px;
    --control-height-lg: 38px;
    --shadow-lg: 0 12px 32px rgba(0, 0, 0, 0.1);
    --width-28: 24px;
    --width-24: 20px;
    --width-20: 16px;
    --width-18: 14px;
    --width-16: 12px;
    --width-label-md: 52px;
  }
}

#mount * {
  box-sizing: border-box;
}

[hidden] {
  display: none !important;
}

:where(#mount) a,
:where(#mount) [role="link"] {
  --color: var(--primary);
  --background-color: transparent;
  outline: none;
  background-color: var(--background-color);
  color: var(--color);
  -webkit-text-decoration: var(--text-decoration);
  text-decoration: var(--text-decoration);
  transition: background-color var(--transition), color var(--transition),
    box-shadow var(--transition), -webkit-text-decoration var(--transition);
  transition: background-color var(--transition), color var(--transition),
    text-decoration var(--transition), box-shadow var(--transition);
  transition: background-color var(--transition), color var(--transition),
    text-decoration var(--transition), box-shadow var(--transition),
    -webkit-text-decoration var(--transition);
}
:where(#mount) a:is([aria-current], :hover, :active, :focus),
:where(#mount) [role="link"]:is([aria-current], :hover, :active, :focus) {
  --color: var(--primary-hover);
  --text-decoration: underline;
}

:where(#mount) label {
  font-size: 13px;
  line-height: 1.3;
  color: var(--text-gray-2, #222222);
}

:where(#mount) button {
  width: 100%;
  font-family: inherit;
  font-size: 15px;
  line-height: 1.3;
  min-height: 44px;
  border-radius: 12px;
  padding: 0 14px;
  border: none;
  background-color: var(--primary, #ea4c89);
  color: #ffffff;
  cursor: pointer;
  transition: background-color 0.2s ease, box-shadow 0.2s ease, color 0.2s ease;
}

:where(#mount) button:hover {
  background-color: var(--primary-hover, #f082ac);
}

:where(#mount) button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

:where(#mount) select,
:where(#mount) input,
:where(#mount) textarea {
  font-family: inherit;
  color: var(--text-gray-2, #222222);
}

:where(#mount) select {
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  font-family: inherit;
  color: var(--text-gray-2, inherit);
  font-size: 13px;
  line-height: 1.3;
  outline: none;
  padding: 8px 16px;
  border: none;
  border-radius: 12px;
  background-color: var(--popup-item-background-color, transparent);
  background-image: var(--icon-xia, none);
  background-repeat: no-repeat;
  background-position: center right 12px;
  background-size: 16px auto;
  cursor: pointer;
}

:where(#mount) input[type="checkbox"] {
  accent-color: var(--primary, #ea4c89);
}

[type="checkbox"],
[type="radio"] {
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  width: 1.25em;
  height: 1.25em;
  margin-top: -0.125em;
  margin-right: 0.375em;
  margin-left: 0;
  -webkit-margin-start: 0;
  margin-inline-start: 0;
  -webkit-margin-end: 0.375em;
  margin-inline-end: 0.375em;
  border-width: var(--border-width);
  font-size: inherit;
  vertical-align: middle;
  cursor: pointer;
}
[type="checkbox"]::-ms-check,
[type="radio"]::-ms-check {
  display: none;
}
[type="checkbox"]:checked,
[type="checkbox"]:checked:active,
[type="checkbox"]:checked:focus,
[type="radio"]:checked,
[type="radio"]:checked:active,
[type="radio"]:checked:focus {
  --background-color: var(--primary);
  --border-color: var(--primary);
  background-image: var(--icon-checkbox);
  background-position: center;
  background-size: 0.75em auto;
  background-repeat: no-repeat;
}
[type="checkbox"] ~ label,
[type="radio"] ~ label {
  display: inline-block;
  margin-right: 0.375em;
  margin-bottom: 0;
  cursor: pointer;
}

[type="checkbox"]:indeterminate {
  --background-color: var(--primary);
  --border-color: var(--primary);
  background-image: var(--icon-minus);
  background-position: center;
  background-size: 0.75em auto;
  background-repeat: no-repeat;
}

[type="radio"] {
  border-radius: 50%;
}
[type="radio"]:checked,
[type="radio"]:checked:active,
[type="radio"]:checked:focus {
  --background-color: var(--primary-inverse);
  border-width: 0.35em;
  background-image: none;
}

:where(#mount) [type="checkbox"][role="switch"] {
  --background-color: var(--switch-background-color);
  --border-color: var(--switch-background-color);
  --color: var(--switch-color);
  width: 2.25em;
  height: 1.25em;
  border: var(--border-width) solid var(--border-color);
  border-radius: 1.25em;
  background-color: var(--background-color);
  line-height: 1.25em;
}
:where(#mount) [type="checkbox"][role="switch"]:focus {
  --background-color: var(--switch-background-color);
  --border-color: var(--switch-background-color);
}
:where(#mount) [type="checkbox"][role="switch"]:checked {
  --background-color: var(--switch-checked-background-color);
  --border-color: var(--switch-checked-background-color);
}
:where(#mount) [type="checkbox"][role="switch"]:before {
  display: block;
  width: calc(1.25em - (var(--border-width) * 2));
  height: 100%;
  border-radius: 50%;
  background-color: var(--color);
  content: "";
  transition: margin 0.1s ease-in-out;
}
:where(#mount) [type="checkbox"][role="switch"]:checked {
  background-image: none;
}
:where(#mount) [type="checkbox"][role="switch"]:checked::before {
  margin-left: calc(1.125em - var(--border-width));
  -webkit-margin-start: calc(1.125em - var(--border-width));
  margin-inline-start: calc(1.125em - var(--border-width));
}

:where(#mount) [type="checkbox"][aria-invalid="false"],
:where(#mount) [type="checkbox"]:checked[aria-invalid="false"],
:where(#mount) [type="radio"][aria-invalid="false"],
:where(#mount) [type="radio"]:checked[aria-invalid="false"],
:where(#mount) [type="checkbox"][role="switch"][aria-invalid="false"],
:where(#mount) [type="checkbox"][role="switch"]:checked[aria-invalid="false"] {
  --border-color: var(--form-element-valid-border-color);
}
:where(#mount) [type="checkbox"][aria-invalid="true"],
:where(#mount) [type="checkbox"]:checked[aria-invalid="true"],
:where(#mount) [type="radio"][aria-invalid="true"],
:where(#mount) [type="radio"]:checked[aria-invalid="true"],
:where(#mount) [type="checkbox"][role="switch"][aria-invalid="true"],
:where(#mount) [type="checkbox"][role="switch"]:checked[aria-invalid="true"] {
  --border-color: var(--form-element-invalid-border-color);
}

.text-black {
  color: var(--text-black-2);
}

.text-gray-2 {
  color: var(--text-gray-2);
}

.text-gray-6 {
  color: var(--text-gray-6);
}

.text-gray-9 {
  color: var(--text-gray-9);
}

.text-gray-c2 {
  color: var(--text-gray-c2);
}

.pt-4 {
  padding-top: 16px;
}

.p-2 {
  padding: 8px;
}

.pl-5 {
  padding-left: 48px;
}

.p-0 {
  padding: 0;
}

.pl-2 {
  padding-left: 8px;
}

.pl-4 {
  padding-left: 24px;
}

.pt-2 {
  padding-top: 8px;
}

.pb-2 {
  padding-bottom: 8px;
}

.pb-4 {
  padding-bottom: 16px;
}

.pb-5 {
  padding-bottom: 20px;
}

.pr-5 {
  padding-right: 48px;
}

.text-sm {
  font-size: 13px;
}

.text-base {
  font-size: 16px;
}

.w-full {
  width: 100%;
}

.flex {
  display: flex;
}

.flex-row {
  flex-direction: row;
}

.flex-wrap {
  flex-wrap: wrap;
}

.flex-end {
  justify-content: flex-end;
}

.flex-grow {
  flex-grow: 1;
}

.justify-between {
  justify-content: space-between;
}

.mb-0 {
  margin-bottom: 0px;
}

.mb-2 {
  margin-bottom: 8px;
}

.mb-4 {
  margin-bottom: 16px;
}

.mb-3 {
  margin-bottom: 12px;
}

.inline-block {
  display: inline-block;
}

.py-2 {
  padding-top: 8px;
  padding-bottom: 8px;
}

.py-2-5 {
  padding-top: 6px;
  padding-bottom: 6px;
}

.mt-0 {
  margin-top: 0;
}

.mt-2 {
  margin-top: 8px;
}

.mt-3 {
  margin-top: 12px;
}

.mt-4 {
  margin-top: 16px;
}

.mt-5 {
  margin-top: 20px;
}

.mt-6 {
  margin-top: 24px;
}

.mb-1 {
  margin-bottom: 4px;
}

.ml-4 {
  margin-left: 24px;
}

.ml-3 {
  margin-left: 16px;
}

.ml-2 {
  margin-left: 8px;
}

.ml-1 {
  margin-left: 4px;
}

.mr-1 {
  margin-right: 4px;
}

.mr-2 {
  margin-right: 8px;
}

.mr-3 {
  margin-right: 16px;
}

.mx-2 {
  margin-left: 8px;
  margin-right: 8px;
}

.pl-3 {
  padding-left: 12px;
}

.pr-3 {
  padding-right: 12px;
}

.p-3 {
  padding: 12px;
}

.px-1 {
  padding-left: 4px;
  padding-right: 4px;
}

.px-3 {
  padding-left: 12px;
  padding-right: 12px;
}

.pt-3 {
  padding-top: 12px;
}

.px-6 {
  padding-left: 18px;
  padding-right: 18px;
}

.px-4 {
  padding-left: 16px;
  padding-right: 16px;
}

.pt-6 {
  padding-top: 20px;
}

.py-3 {
  padding-top: 12px;
  padding-bottom: 12px;
}

.py-0 {
  padding-top: 0;
  padding-bottom: 0;
}

.left-auto {
  left: auto !important;
}

.max-h-28 {
  max-height: 112px;
}

.max-h-30 {
  max-height: 120px;
}

.overflow-y-scroll {
  overflow-y: scroll;
}

.text-xs {
  font-size: 12px;
}

.inline-flex {
  display: inline-flex;
}

.flex-1 {
  flex: 1;
}

.flex-3 {
  flex: 3;
}

.flex-4 {
  flex: 4;
}

.flex-2 {
  flex: 2;
}

.items-center {
  align-items: center;
}

.max-content {
  width: max-content;
}

.justify-center {
  justify-content: center;
}

.items-end {
  align-items: flex-end;
}

.items-baseline {
  align-items: baseline;
}

.my-5 {
  margin-top: 48px;
  margin-bottom: 48px;
}

.my-4 {
  margin-top: 24px;
  margin-bottom: 24px;
}

.my-3 {
  margin-top: 16px;
  margin-bottom: 16px;
}

.pt-3 {
  padding-top: 12px;
}

.px-3 {
  padding-left: 12px;
  padding-right: 12px;
}

.pt-2 {
  padding-top: 8px;
}

.px-2 {
  padding-left: 8px;
  padding-right: 8px;
}

.pt-1 {
  padding-top: 4px;
}

.px-1 {
  padding-left: 4px;
  padding-right: 4px;
}

.pb-2 {
  padding-bottom: 8px;
}

.justify-end {
  justify-content: flex-end;
}

.w-auto {
  width: auto;
}

.shrink-0 {
  flex-shrink: 0;
}

.text-right {
  text-align: right;
}

.clickable {
  cursor: pointer;
}

.close {
  cursor: pointer;
  width: 16px;
  height: 16px;
  background-image: var(--icon-close);
  background-position: center;
  background-size: auto 1rem;
  background-repeat: no-repeat;
  opacity: 0.5;
  transition: opacity var(--transition);
}

.padding-two-column {
  padding-left: 40px;
  padding-right: 40px;
}

.muted {
  color: #999;
}

.text-label {
  color: #666;
}

.display-none {
  display: none;
}

/* dark use #18232c */
@media (prefers-color-scheme: dark) {
  .text-label {
    color: #9ca3af;
  }
}

.text-decoration-none {
  text-decoration: none;
}

.text-decoration-none:is([aria-current], :hover, :active, :focus),
[role="link"]:is([aria-current], :hover, :active, :focus) {
  --text-decoration: none !important;
  background-color: transparent !important;
}

.text-overflow-ellipsis {
  text-overflow: ellipsis;
  overflow: hidden;
  white-space: nowrap;
}

.max-w-20 {
  max-width: 180px;
  white-space: nowrap;
}

[data-theme="light"],
#mount:not([data-theme="dark"]) {
  --popup-footer-background-color: #e8eaeb;
  --popup-content-background-color: #ffffff;
  --popup-item-background-color: #f3f5f6;
  --popup-item-hover-background-color: #eaeced;
  --popup-trial-pro-background-color: #f9fbfc;
  --service-select-content-shadow: 0px 2px 12px 0px rgba(75, 76, 77, 0.2);
  --service-select-border-color: #fafafa;
  --service-select-selected-background-color: #f3f5f6;
  --download-app-background: #f3f5f6;
}

[data-theme="dark"] {
  --popup-footer-background-color: #0d0d0d;
  --popup-content-background-color: #191919;
  --popup-item-background-color: #272727;
  --popup-item-hover-background-color: #333333;
  --popup-trial-pro-background-color: #222222;
  --service-select-content-shadow: 0px 2px 12px 0px rgba(0, 0, 0, 0.9);
  --service-select-border-color: #2c2c2c;
  --service-select-selected-background-color: #333333;
  --download-app-background: #333;
}

#mount {
  min-width: 268px;
}

body {
  padding: 0;
  margin: 0 auto;
  min-width: 268px;
  border-radius: 10px;
}

.popup-container {
  font-size: 16px;
  --font-size: 16px;
  color: #666;
  background-color: var(--popup-footer-background-color);
  width: 316px;
  min-width: 316px;
}

.popup-content {
  background-color: var(--popup-content-background-color);
  border-radius: 0px 0px 12px 12px;
  padding: 16px 20px;
}

.immersive-translate-popup-overlay {
  position: fixed;
  top: 0;
  left: 0;
  height: 100%;
  width: 100%;
  touch-action: none;
}

.immersive-translate-popup-wrapper {
  background: var(--background-color);
  border-radius: 10px;
  border: 1px solid var(--muted-border-color);
}

.main-button {
  font-size: 15px;
  vertical-align: middle;
  border-radius: 12px;
  padding: unset;
  height: 44px;
  line-height: 44px;
}

select.language-select,
select.translate-service,
select.min-select {
  --form-element-spacing-horizontal: 0;
  margin-bottom: 0px;
  max-width: unset;
  flex: 1;
  overflow: hidden;
  font-size: 13px;
  border: none;
  border-radius: 8px;
  padding-right: 30px;
  padding-left: 0px;
  background-position: center right 12px;
  background-size: 16px auto;
  background-image: var(--icon-xia);
  text-overflow: ellipsis;
  color: var(--text-gray-2);
  background-color: transparent;
  box-shadow: unset !important;
  cursor: pointer;
}

select.more {
  background-position: center right;
  padding-right: 20px;
}

select.translate-service {
  color: var(--text-black-2);
}

.min-select-container.disabled {
  opacity: 0.5;
  pointer-events: none;
}

.popup-footer {
  background-color: var(--popup-footer-background-color);
  height: 40px;
}

.language-select-container {
  position: relative;
  width: 100%;
  background-color: var(--popup-item-background-color);
  height: 55px;
  border-radius: 12px;
}

select.language-select {
  color: var(--text-black-2);
  font-size: 14px;
  padding: 8px 24px 24px 16px;
  position: absolute;
  border-radius: 12px;
  position: absolute;
  left: 0;
  right: 0;
  top: 0;
  bottom: 0;
}

.language-select-container label {
  position: absolute;
  bottom: 10px;
  left: 16px;
  font-size: 12px;
  color: var(--text-gray-9);
  line-height: 12px;
  margin: 0;
}

.translation-service-container {
  background-color: var(--popup-item-background-color);
  border-radius: 12px;
}

.min-select-container {
  display: flex;
  justify-content: space-between;
  align-items: center;
  height: 44px;
  background-color: var(--popup-item-background-color);
  padding-left: 16px;
}

.min-select-container:first-child {
  border-top-left-radius: 10px;
  border-top-right-radius: 10px;
}

.min-select-container:last-child {
  border-bottom-left-radius: 10px;
  border-bottom-right-radius: 10px;
}

.min-select-container:only-child {
  border-radius: 10px;
}

.translate-mode {
  width: 44px;
  height: 44px;
  border-radius: 22px;
  background-color: var(--popup-item-background-color);
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  cursor: pointer;
}

.translate-mode svg {
  fill: var(--text-gray-2);
}

.widgets-container {
  display: flex;
  align-items: stretch;
  justify-content: space-between;
  width: 100%;
  gap: 9px;
}

/* 当只有两个小组件时的样式优化 */
.widgets-container.widgets-two-items {
  gap: 16px;
}

.widgets-container.widgets-two-items .widget-item {
  flex: 0 1 auto;
  min-width: 93px;
  max-width: 120px;
}

.widget-item {
  display: flex;
  max-width: 93px;
  flex-direction: row;
  align-items: center;
  justify-content: center;
  background-color: var(--popup-item-background-color);
  font-size: 12px;
  min-height: 44px;
  height: 100%;
  border-radius: 8px;
  cursor: pointer;
  flex: 1;
  padding: 8px 4px;
  text-align: center;
}

.widget-icon-text {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  color: var(--text-gray-2);
}

.widgets-container svg {
  fill: var(--text-gray-2);
  color: var(--text-gray-2);
}

.share-button-container {
  display: flex;
  align-items: center;
  cursor: pointer;
  padding: 2px 3px 0 8px;
}

.share-button-container svg {
  fill: var(--text-gray-9);
}

.min-select-container:hover,
.language-select-container:hover,
.widget-item:hover,
.translate-mode:hover {
  background-color: var(--popup-item-hover-background-color);
}

.main-button:hover {
  background-color: #f5508f;
}

.share-button-container:hover {
  background-color: var(--popup-item-background-color);
  border-radius: 6px;
}

.error-boundary {
  background: #fff2f0;
  border: 1px solid #ffccc7;
  display: flex;
  padding: 12px;
  font-size: 14px;
  color: rgba(0, 0, 0, 0.88);
  word-break: break-all;
  margin: 12px;
  border-radius: 12px;
  flex-direction: column;
}

.upgrade-pro {
  border-radius: 11px;
  background: linear-gradient(57deg, #272727 19.8%, #696969 82.2%);
  padding: 2px 8px;
  transform: scale(0.85);
}

.upgrade-pro span {
  background: linear-gradient(180deg, #ffeab4 17.65%, #f8c235 85.29%);
  background-clip: text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  font-size: 12px;
  margin-left: 4px;
}

.upgrade-pro svg {
  margin-top: -2px;
}

.upgrade-pro:hover {
  background: linear-gradient(57deg, #3d3d3d 19.8%, #949494 82.2%);
}

.border-bottom-radius-0 {
  border-bottom-left-radius: 0 !important;
  border-bottom-right-radius: 0 !important;
}

.trial-pro-container {
  border-radius: 0px 0px 12px 12px;
  background: var(--popup-trial-pro-background-color);
  display: flex;
  align-items: center;
  height: 44px;
  padding-left: 16px;
  padding-right: 12px;
  font-size: 12px;
}

.trial-pro-container label {
  line-height: 13px;
  color: var(--text-black-2);
}

.trial-pro-container img {
  margin-left: 5px;
}

.cursor-pointer {
  cursor: pointer;
}

.upgrade-pro-discount-act {
  height: 25px;
  display: flex;
  padding: 0 4px;
  align-items: center;
  border-radius: 15px;
  background: linear-gradient(
    90deg,
    #cefbfa 11.33%,
    #d7f56f 63.75%,
    #fccd5e 100%
  );
  transform: scale(0.9);
  box-shadow: 0px 1.8px 3.6px 0px rgba(0, 0, 0, 0.1);
  cursor: pointer;
}

.upgrade-pro-discount-act span {
  font-size: 12px;
  font-weight: 700;
  margin-left: 4px;
  color: #222222;
}

.upgrade-pro-discount-act:hover {
  text-decoration: unset;
  background: linear-gradient(
    90deg,
    #e2fffe 11.33%,
    #e6ff91 63.75%,
    #ffdf93 100%
  );
}

.custom-select-container {
  width: 200px;
  position: relative;
  flex: 1;
}

#translation-service-select {
  padding-right: 12px;
  padding-left: 6px;
}

.custom-select-content {
  border-radius: 12px;
  background: var(--popup-content-background-color);
  box-shadow: var(--service-select-content-shadow);
  border: 1px solid var(--service-select-border-color);
  padding: 4px 5px;
  position: absolute;
  left: -10px;
  right: 0;
  z-index: 100;
  overflow-y: auto;
}

.custom-select-item.default {
  width: 100%;
  padding: 0;
}

.custom-select-item {
  font-size: 13px;
  padding: 5px 6px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  cursor: pointer;
  color: var(--text-black-2);
  width: auto;
  overflow: hidden;
  height: 30px;
  line-height: 30px;
}

.custom-select-item-img {
  width: 20px;
  height: 20px;
  margin-right: 4px;
}

@media (prefers-color-scheme: dark) {
  .custom-select-item-img {
    margin-right: 6px;
  }
}

.custom-select-content .custom-select-item.selected,
.custom-select-content .custom-select-item:hover {
  background: var(--service-select-selected-background-color);
}

.custom-select-item > span {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.custom-select-item-pro {
  font-size: 12px;
  margin-left: 6px;
  display: flex;
}

.custom-select-item-pro img {
  margin: 0 3px;
  width: 20px;
  flex-shrink: 0;
}

.custom-select-group-header {
  font-size: 12px;
  font-weight: 500;
  color: var(--text-gray-9);
  padding: 6px 8px 4px;
  margin-top: 2px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.more-container {
  position: relative;
}

.new-menu-indicator {
  position: absolute;
  width: 8px;
  height: 8px;
  background-color: #ef3434;
  border-radius: 50%;
  right: 18px;
  top: 4px;
}

.download-app {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  border-radius: 8px;
  background: var(--download-app-background);
  padding: 4px 8px;
  color: var(--text-gray-6);
  font-size: 12px;
  cursor: pointer;
  transition: all 0.2s ease-in-out;
}

/* Popup 动画效果 */
@keyframes popup-fade-in {
  from {
    opacity: 0;
    transform: translateY(10px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

@keyframes popup-fade-out {
  from {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
  to {
    opacity: 0;
    transform: translateY(10px) scale(0.95);
  }
}

.popup-generic-content {
  animation: popup-fade-in 0.2s ease-out;
}

.popup-generic-content.hiding {
  animation: popup-fade-out 0.15s ease-in;
}

select.min-select {
  --form-element-spacing-horizontal: 0;
  margin-bottom: 4px;
  max-width: 128px;
  overflow: hidden;
  color: var(--primary);
  font-size: 13px;
  border: none;
  padding: 0;
  padding-right: 20px;
  text-overflow: ellipsis;
  color: var(--color);
}
select.min-select-secondary {
  color: var(--color);
}
select.min-select:focus {
  outline: none;
  border: none;
  --box-shadow: none;
}

select.min-select-left {
  padding-right: 0px;
  /* padding-left: 24px; */
  /* background-position: center left 0; */
  text-overflow: ellipsis;
  text-align: left;
}

select.transform-padding-left {
  padding-left: 12px;
  transform: translateX(-12px);
  background-position: center right 0px;
}

select.text-gray-6 {
  color: var(--text-gray-6);
}

/* dark use black, for windows */
@media (prefers-color-scheme: dark) {
  select.language-select option,
  select.translate-service option,
  select.min-select option {
    background-color: #666666;
  }
}

select.min-select-no-arrow {
  background-image: none;
  padding-right: 0;
}



.activity-tips {
  border-radius: 8px;
  padding: 0px 8px;
  min-height: 28px;
  background: linear-gradient(83deg, #FACCDE -0.87%, #FCE7EF 43.13%, #FBD6E4 72.08%, #FFB3D1 96.34%);  gap: 2px;
  color: #333;
  cursor: pointer;
  gap: 4px;
}

.activity-tips-icon {
  width: 18px;
  height: 18px;
  flex-shrink: 0;
}

.countdown-container {
  min-width: 50px;
  text-align: left;
  font-weight: 600;
  font-size: 12px;
  letter-spacing: 0.01em;
}

.activity-tips-text {
  font-weight: 600;
  max-width: 100px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

html {
  font-size: 17px;
}

@media print {
  .imt-fb-container {
    display: none !important;
  }
}

#mount {
  position: absolute;
  display: none;
  min-width: 250px;
  height: auto;
  --font-size: 17px;
  font-size: 17px;
}

/* float-ball */
.imt-fb-container {
  position: fixed;
  padding: 0;
  top: 335px;
  width: fit-content;
  display: flex;
  flex-direction: column;
  display: none;
  direction: ltr;
}

.imt-fb-container.left {
  align-items: flex-start;
  left: 0;
}

.imt-fb-container.right {
  align-items: flex-end;
  right: 0;
}

.imt-fb-btn {
  cursor: pointer;
  background: var(--float-ball-more-button-background-color);
  height: 36px;
  width: 56px;
  box-shadow: 2px 6px 10px 0px #0e121629;
}

.imt-fb-btn.left {
  border-top-right-radius: 36px;
  border-bottom-right-radius: 36px;
}

.imt-fb-btn.right {
  border-top-left-radius: 36px;
  border-bottom-left-radius: 36px;
}

.imt-fb-btn div {
  background: var(--float-ball-more-button-background-color);
  height: 36px;
  width: 54px;
  display: flex;
  align-items: center;
}

.imt-fb-btn.left div {
  border-top-right-radius: 34px;
  border-bottom-right-radius: 34px;
  justify-content: flex-end;
}

.imt-fb-btn.right div {
  border-top-left-radius: 34px;
  border-bottom-left-radius: 34px;
}

.imt-fb-logo-img {
  width: 20px;
  height: 20px;
  margin: 0 10px;
}

.imt-fb-logo-img-big-bg {
  width: 28px;
  height: 28px;
  margin: 0;
  padding: 4px;
  background-color: #ed6d8f;
  border-radius: 50%;
  margin: 0 5px;
}

.imt-float-ball-translated {
  position: absolute;
  width: 11px;
  height: 11px;
  bottom: 4px;
  right: 20px;
}

.btn-animate {
  -webkit-transform: translate3d(0, 0, 0);
  transform: translate3d(0, 0, 0);
  -webkit-transition: -webkit-transform ease-out 250ms;
  transition: -webkit-transform ease-out 250ms;
  transition: transform ease-out 250ms;
  transition: transform ease-out 250ms, -webkit-transform ease-out 250ms;
}

.imt-fb-setting-btn {
  margin-right: 18px;
  width: 28px;
  height: 28px;
}

.immersive-translate-popup-wrapper {
  background: var(--background-color);
  border-radius: 20px;
  box-shadow: 2px 10px 24px 0px #0e121614;
  border: none;
}

.popup-container {
  border-radius: 20px;
}

.popup-content {
  border-radius: 20px 20px 12px 12px;
}
.popup-footer {
  border-radius: 20px;
}

.imt-fb-close-button {
  pointer-events: all;
  cursor: pointer;
  position: absolute;
  margin-top: -10px;
}

.imt-fb-close-content {
  padding: 22px;
  width: 320px;
  pointer-events: all;
}

.imt-fb-close-title {
  font-weight: 500;
  color: var(--h2-color);
}

.imt-fb-close-radio-content {
  background-color: var(--background-light-green);
  padding: 8px 20px;
}

.imt-fb-radio-sel,
.imt-fb-radio-nor {
  width: 16px;
  height: 16px;
  border-radius: 8px;
  flex-shrink: 0;
}

.imt-fb-radio-sel {
  border: 2px solid var(--primary);
  display: flex;
  align-items: center;
  justify-content: center;
}

.imt-fb-radio-sel div {
  width: 8px;
  height: 8px;
  border-radius: 4px;
  background-color: var(--primary);
}

.imt-fb-radio-nor {
  border: 2px solid #d3d4d6;
}

.imt-fb-primary-btn {
  background-color: var(--primary);
  width: 72px;
  height: 32px;
  color: white;
  border-radius: 8px;
  text-align: center;
  line-height: 32px;
  font-size: 16px;
  cursor: pointer;
}

.imt-fb-default-btn {
  border: 1px solid var(--primary);
  width: 72px;
  height: 32px;
  border-radius: 8px;
  color: var(--primary);
  line-height: 32px;
  text-align: center;
  font-size: 16px;
  cursor: pointer;
}

.imt-fb-guide-container {
  width: 312px;
  transform: translateY(-45%);
}

.imt-fb-guide-bg {
  position: absolute;
  left: 30px;
  right: 0;
  top: 0;
  bottom: 0;
  z-index: -1;
  height: 100%;
  width: 90%;
}

.imt-fb-guide-bg.left {
  transform: scaleX(-1);
}

.imt-fb-guide-content {
  margin: 16px -30px 80px 0px;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.imt-fb-guide-content.left {
  margin: 16px 21px 60px 32px;
}

.imt-fb-guide-img {
  width: 220px;
  height: 112px;
}

.imt-fb-guide-message {
  font-size: 14px;
  line-height: 28px;
  color: #333333;
  white-space: pre-wrap;
  text-align: center;
  font-weight: 700;
  margin-bottom: 20px;
}

.imt-manga-guide-message {
  font-size: 16px;
  line-height: 24px;
  color: #333333;
  text-align: center;
  font-weight: 500;
  margin-bottom: 12px;
}

.imt-fb-guide-button {
  margin-top: 16px;
  line-height: 40px;
  height: 40px;
  padding: 0 20px;
  width: unset;
}

.imt-fb-more-buttons {
  box-shadow: 0px 2px 10px 0px #00000014;
  border: none;
  background: var(--float-ball-more-button-background-color);
  width: 36px;
  display: flex;
  flex-direction: column;
  border-radius: 18px;
  margin-top: 0px;
  padding: 7px 0 7px 0;
}

.imt-fb-more-buttons > div {
  margin: auto;
}

.imt-fb-side,
.imt-fb-reward {
  border-radius: 50%;
  cursor: pointer;
  pointer-events: all;
  position: relative;
}

.imt-fb-side {
  margin: 10px 0;
}

.imt-fb-new-badge {
  width: 26px;
  height: 14px;
  padding: 3px;
  background-color: #f53f3f;
  border-radius: 4px;
  position: absolute;
  top: -5px;
  right: 15px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.imt-fb-side *,
.imt-fb-reward * {
  pointer-events: all;
}

.imt-fb-more-button {
  width: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}
/* Sheet.css */
.immersive-translate-sheet {
  position: fixed;
  transform: translateY(100%);
  /* Start off screen */
  left: 0;
  right: 0;
  background-color: white;
  transition: transform 0.3s ease-out;
  /* Smooth slide transition */
  box-shadow: 0px -2px 10px rgba(0, 0, 0, 0.1);
  /* Ensure it's above other content */
  bottom: 0;
  border-top-left-radius: 16px;
  border-top-right-radius: 16px;
  overflow: hidden;
}

.immersive-translate-sheet.visible {
  transform: translateY(0);
}

.immersive-translate-sheet-backdrop {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.5);
  opacity: 0;
  transition: opacity 0.3s ease-out;
}

.immersive-translate-sheet-backdrop.visible {
  opacity: 1;
}

.popup-container-sheet {
  max-width: 100vw;
  width: 100vw;
}

.imt-no-events svg * {
  pointer-events: none !important;
}

.imt-manga-button {
  width: 36px;
  display: flex;
  flex-direction: column;
  position: relative;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  pointer-events: all;
  margin: 0 0 10px 0;
  background-color: var(--float-ball-more-button-background-color);
  border-radius: 18px;
  filter: drop-shadow(0px 2px 10px rgba(0, 0, 0, 0.08));
  opacity: 0.5;
  right: 8px;
  padding: 10px 0 4px 0;
}

.imt-manga-feedback {
  cursor: pointer;
  margin-bottom: 10px;
}

.imt-fb-feedback {
  cursor: pointer;
  margin-top: 10px;
}

.imt-fb-upgrade-button {
  cursor: pointer;
  margin-top: 10px;
}

.imt-manga-button:hover {
  opacity: 1;
}

.imt-manga-translated {
  position: absolute;
  left: 24px;
  top: 20px;
}

.imt-float-ball-loading {
  animation: imt-loading-animation 0.6s infinite linear !important;
}

.imt-manga-guide-bg {
  position: absolute;
  left: 0;
  right: 0;
  top: 0;
  bottom: 0;
  z-index: -1;
  width: 100%;
  transform: translateY(-50%);
}
.imt-manga-guide-content {
  position: absolute;
  top: 15px;
  left: 0;
  right: 0;
  margin: 0 40px 0;
}

.img-manga-guide-button {
  width: fit-content;
  margin: 0 auto;
}

.img-manga-close {
  position: absolute;
  bottom: -200px;
  width: 32px;
  height: 32px;
  left: 0;
  right: 0;
  margin: auto;
  cursor: pointer;
}

.imt-fb-container.dragging .imt-fb-more-buttons,
.imt-fb-container.dragging .imt-manga-button,
.imt-fb-container.dragging .btn-animate:not(.imt-fb-btn) {
  display: none !important;
}

.imt-fb-container.dragging .imt-fb-btn {
  border-radius: 50% !important;
  width: 36px !important;
  height: 36px !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  cursor: move !important;
}

.imt-fb-container.dragging .imt-fb-btn div {
  border-radius: 50% !important;
  width: 36px !important;
  height: 36px !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  margin: 0 !important;
}

.imt-fb-container.dragging .imt-fb-btn.left,
.imt-fb-container.dragging .imt-fb-btn.right {
  border-radius: 50% !important;
}

.imt-fb-container.dragging .imt-fb-btn.left div,
.imt-fb-container.dragging .imt-fb-btn.right div {
  border-radius: 50% !important;
}

.imt-fb-container.dragging .imt-fb-logo-img {
  margin: 0 !important;
  padding: 4px !important;
}

.imt-fb-container.dragging .imt-float-ball-translated {
  right: 2px !important;
  bottom: 2px !important;
}

@-webkit-keyframes imt-loading-animation {
  from {
    -webkit-transform: rotate(0deg);
  }

  to {
    -webkit-transform: rotate(359deg);
  }
}

@keyframes imt-loading-animation {
  from {
    transform: rotate(0deg);
  }

  to {
    transform: rotate(359deg);
  }
}

.imt-fb-icon {
  color: #666666;
}

[data-theme="dark"] .imt-fb-icon {
  color: #b3b3b3;
}

[data-theme="light"] .imt-fb-icon {
  color: #666666;
}
</style><div id="mount" style="display: block;"><div hidden="" id="immersive-translate-popup-overlay" class="immersive-translate-popup-overlay" style="z-index: 2147483647; background-color: rgba(0, 0, 0, 0.5);"><div class="immersive-translate-popup-wrapper" style="position: fixed; top: 50%; left: 50%; transform: translateX(-50%) translateY(-50%);"></div></div></div></template></div></html>